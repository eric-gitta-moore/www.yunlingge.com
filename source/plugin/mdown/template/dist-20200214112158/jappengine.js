/*url伪地址路由映射, (c) 2016 mawentao */

/* jappengine.js, (c) 2016 mawentao */

define("core/ajax",["require"],function(e){var t={},n={},r=[];return n.getAjaxUrl=function(e){return dz.ajaxapi+e},n.getJavaAjaxUrl=function(e){return dz.javaapi+e},n.abortAll=function(){console.log("abort_all_ajax_requests");for(var e=0;e<r.length;++e){var t=r[e];t.abort()}r=[]},n.ajaxrequest=function(e,t,n,i,o){var a;a=jQuery.ajax({url:t,type:e,dataType:"json",data:n,async:!o,complete:function(e){},success:function(e){i(e)},error:function(t,n,r){var i="Error("+t.readyState+") : "+n;"abort"==n?console.log("abort ajax: "+e):console.log(i)}}),r.push(a)},n.post=function(e,t,r,i){var o=n.getAjaxUrl(e);n.ajaxrequest("post",o,t,r,i)},n.postjava=function(e,t,r,i){var o=n.getJavaAjaxUrl(e);n.ajaxrequest("post",o,t,r,i)},n.postjava2=function(e,t,r,i){var o=n.getJavaAjaxUrl(e);n.ajaxrequest("post",o,t,r,i)},n.get=function(e,t,r,i){var o=n.getAjaxUrl(e);n.ajaxrequest("get",o,t,r,i)},n.getjava=function(e,t,r,i){var o=n.getJavaAjaxUrl(e);n.ajaxrequest("get",o,t,r,i)},n.loadcache=function(e,n,r){t[e]?n(t[e]):this.post(e,{},function(r){t[e]=r,n(r)},noanimation)},n.unsetcache=function(e){t[e]=null},n.clearcache=function(){t={}},n}),define("common/dict",["require"],function(e){function t(e){return n[e]?n[e]:(ajax.post("dict&action=getOptions",{key:e},function(t){if(0!=t.errno)alert(t.errmsg);else{n[e]=[];for(var r=0;r<t.data.length;++r)n[e].push(t.data[r])}},!0),n[e])}var n={active:[{text:"否",value:0},{text:"是",value:1}],fieldType:[{text:"文本",value:1},{text:"数字",value:2},{text:"图片",value:3},{text:"音频",value:4},{text:"视频",value:5}]},r={};return r.get_options=function(e,n){var r=t(e),i=[];n&&i.push(n);for(var o=0;o<r.length;++o)i.push(r[o]);return i},r.get_map=function(e){for(var n={},r=t(e),i=0;i<r.length;++i){var o=r[i];n[o.value]=o.text}return n},r}),define("common/posnav",["require"],function(e){var t={};return t.get=function(e){var t='<ul class="posul">';t+='<li><a href="#/"><i class="fa fa-home" style="font-size:16px;"></i></a></li>';var n=[];e instanceof Array?n=e:n.push({name:e});for(var r=0;r<n.length;++r){var i=n[r];t+='<li><i class="fa fa-angle-right" style="font-size:16px;margin:0 5px;"></i></li>',t+=i.href?'<li><a href="'+i.href+'">'+i.name+"</a></li>":"<li>"+i.name+"</li>"}return t+="</ul>"},t}),define("er/util",[],function(){var now=+new Date,util={};util.guid=function(){return"er"+now++},util.mix=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e};var nativeBind=Function.prototype.bind;util.bind=nativeBind?function(e){return nativeBind.apply(e,[].slice.call(arguments,1))}:function(e,t){var n=[].slice.call(arguments,2);return function(){var r=n.concat([].slice.call(arguments));return e.apply(t,r)}},util.noop=function(){};var dontEnumBug=!{toString:1}.propertyIsEnumerable("toString");util.inherits=function(e,t){var n=function(){};n.prototype=t.prototype;var r=new n,i=e.prototype;e.prototype=r;for(var o in i)r[o]=i[o];return dontEnumBug&&(i.hasOwnProperty("toString")&&(r.toString=i.toString),i.hasOwnProperty("valueOf")&&(r.valueOf=i.valueOf)),e.prototype.constructor=e,e},util.parseJSON=function(text){return text?window.JSON&&"function"==typeof JSON.parse?JSON.parse(text):eval("("+text+")"):void 0};var whitespace=/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g;return util.trim=function(e){return e.replace(whitespace,"")},util.encodeHTML=function(e){return e+="",e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},util.getElement=function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},util}),define("er/Observable",["require","./util"],function(e){function t(){this._events={}}var n="_erObservableGUID";return t.prototype.on=function(t,r){this._events||(this._events={});var i=this._events[t];i||(i=this._events[t]=[]),r.hasOwnProperty(n)||(r[n]=e("./util").guid()),i.push(r)},t.prototype.un=function(e,t){if(this._events){if(!t)return void(this._events[e]=[]);var n=this._events[e];if(n)for(var r=0;r<n.length;r++)n[r]===t&&(n.splice(r,1),r--)}},t.prototype.fire=function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t.type);var r=this["on"+e];if("function"==typeof r&&r.call(this,t),this._events){null==t&&(t={}),"[object Object]"!==Object.prototype.toString.call(t)&&(t={data:t}),t.type=e,t.target=this;var i={},o=this._events[e];if(o){o=o.slice();for(var a=0;a<o.length;a++){var s=o[a];i.hasOwnProperty(s[n])||s.call(this,t)}}if("*"!==e){var l=this._events["*"];if(!l)return;l=l.slice();for(var a=0;a<l.length;a++){var s=l[a];i.hasOwnProperty(s[n])||s.call(this,t)}}}},t.enable=function(e){e._events={},e.on=t.prototype.on,e.un=t.prototype.un,e.fire=t.prototype.fire},t}),define("er/assert",[],function(){if(window.DEBUG){var e=function(e,t){if(!e)throw new Error(t)};return e.has=function(t,n){e(null!=t,n)},e.equals=function(t,n,r){e(t===n,r)},e.hasProperty=function(t,n,r){e(null!=t[n],r)},e.lessThan=function(t,n,r){e(n>t,r)},e.greaterThan=function(t,n,r){e(t>n,r)},e.lessThanOrEquals=function(t,n,r){e(n>=t,r)},e.greaterThanOrEquals=function(t,n,r){e(t>=n,r)},e}var e=function(){};return e.has=e,e.equals=e,e.hasProperty=e,e.lessThan=e,e.greaterThan=e,e.lessThanOrEquals=e,e.greaterThanOrEquals=e,e}),define("er/Deferred",["require","./util","./assert","./Observable"],function(e){function t(e){function t(){for(var t=0;t<n.length;t++){var r=n[t];r.apply(e.promise,e._args)}}if("pending"!==e.state){var n="resolved"===e.state?e._doneCallbacks.slice():e._failCallbacks.slice();e.syncModeEnabled?t():a(t),e._doneCallbacks=[],e._failCallbacks=[]}}function n(e,t,n,i){return function(){if("function"==typeof n){var o=t.resolver,a=n.apply(e.promise,arguments);r.isPromise(a)?a.then(o.resolve,o.reject):o.resolve(a)}else t[i].apply(t,e._args)}}function r(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:i.bind(this.done,this),fail:i.bind(this.fail,this),ensure:i.bind(this.ensure,this),then:i.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:i.bind(this.resolve,this),reject:i.bind(this.reject,this)}}var i=e("./util"),o=e("./assert"),a="function"==typeof window.setImmediate?function(e){window.setImmediate(e)}:function(e){window.setTimeout(e,0)};return e("./Observable").enable(r),r.isPromise=function(e){return e&&"function"==typeof e.then},r.prototype.syncModeEnabled=!1,r.prototype.resolve=function(){"pending"===this.state&&(this.state="resolved",this._args=[].slice.call(arguments),r.fire("resolve",{deferred:this,args:this._args,reason:this._args[0]}),t(this))},r.prototype.reject=function(){"pending"===this.state&&(this.state="rejected",this._args=[].slice.call(arguments),r.fire("reject",{deferred:this,args:this._args,reason:this._args[0]}),t(this))},r.prototype.done=function(e){return this.then(e)},r.prototype.fail=function(e){return this.then(null,e)},r.prototype.ensure=function(e){return this.then(e,e)},r.prototype.then=function(e,i){var o=new r;return o.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(n(this,o,e,"resolve")),this._failCallbacks.push(n(this,o,i,"reject")),t(this),o.promise},r.all=function(){function e(e){a--,o.greaterThanOrEquals(a,0,"workingCount should be positive");var t=[].slice.call(arguments,1);t.length<=1&&(t=t[0]),l[e]=t,0===a&&c[s].apply(c,l)}function t(){s="reject",e.apply(this,arguments)}var n=[].concat.apply([],arguments),a=n.length;if(!a)return r.resolved();for(var s="resolve",l=[],c=new r,u=0;u<n.length;u++){var d=n[u];d.then(i.bind(e,d,u),i.bind(t,d,u))}return c.promise},r.resolved=function(){var e=new r;return e.resolve.apply(e,arguments),e.promise},r.rejected=function(){var e=new r;return e.reject.apply(e,arguments),e.promise},r.require=function(){var e=[].slice.call(arguments),t=new r;return window.require(e,t.resolver.resolve),t.promise.abort=t.resolver.reject,t.promise},r}),define("er/events",["require","./Observable"],function(e){var t={notifyError:function(e){return"string"==typeof e&&(e=new Error(e)),this.fire("error",{error:e}),e}};return e("./Observable").enable(t),t}),define("er/config",{mainElement:"main",indexURL:"/",systemName:"",noAuthorityLocation:"/401",notFoundLocation:"/404"}),define("er/locator",["require","./config","./events","./Observable"],function(e){function t(){var e=location.href.indexOf("#"),t=-1===e?"":location.href.slice(e);return t}function n(){var e=t();a.redirect(e)}function r(e){window.addEventListener?window.addEventListener("hashchange",n,!1):"onhashchange"in window&&document.documentMode>7?window.attachEvent("onhashchange",n):l=setInterval(n,100),e&&(c=setTimeout(n,0))}function i(){l&&(clearInterval(l),l=null),c&&(clearTimeout(c),c=null),window.removeEventListener?window.removeEventListener("hashchange",n,!1):"onhashchange"in window&&document.documentMode>7&&window.detachEvent("onhashchange",n)}function o(e,n){var o=s!==e;return o&&t()!==e&&(n.silent?(i(),location.hash=e,r(!1)):location.hash=e),s=e,o}var a={},s="",l=0,c=1;return a.start=function(){r(!0)},a.stop=i,a.resolveURL=function(t){return t+="",0===t.indexOf("#")&&(t=t.slice(1)),t&&"/"!==t||(t=e("./config").indexURL),t},a.redirect=function(t,n){n=n||{},t=a.resolveURL(t);var r=s,i=o(t,n);(i||n.force)&&(n.silent||a.fire("redirect",{url:t,referrer:r}),e("./events").fire("redirect",{url:t,referrer:r}))},a.reload=function(){s&&a.redirect(s,{force:!0})},e("./Observable").enable(a),a}),define("er/Action",["require","./util","./Observable","./Deferred","./events","./locator","./locator"],function(e){function t(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];n.success||e.push(n)}return this.handleError(e)}function n(){this.disposed=!1}var r=e("./util"),i=e("./Observable");return n.prototype.context=null,n.prototype.modelType=null,n.prototype.viewType=null,n.prototype.enter=function(n){this.context=n||{},this.fire("enter");var i=n&&n.url&&n.url.getQuery(),o=r.mix({},n,i);if(this.model=this.createModel(o),this.model&&"function"==typeof this.model.load){var a=this.model.load();return a.then(r.bind(this.forwardToView,this),r.bind(t,this))}return this.forwardToView(),e("./Deferred").resolved(this)},n.prototype.handleError=function(e){throw e},n.prototype.createModel=function(e){if(this.modelType){var t=new this.modelType(e);return t}return{}},n.prototype.forwardToView=function(){if(this.disposed)return this;if(this.fire("modelloaded"),this.view=this.createView(),this.view)this.view.model=this.model,this.view.container||(this.view.container=this.context.container),this.fire("beforerender"),this.view.render(),this.fire("rendered"),this.initBehavior(),this.fire("entercomplete");else{var t=e("./events");t.notifyError("No view attached to this action")}return this},n.prototype.createView=function(){return this.viewType?new this.viewType:null},n.prototype.initBehavior=function(){},n.prototype.leave=function(){this.disposed=!0,this.fire("beforeleave"),this.model&&("function"==typeof this.model.dispose&&this.model.dispose(),this.model=null),this.view&&("function"==typeof this.view.dispose&&this.view.dispose(),this.view=null),this.fire("leave")},n.prototype.redirect=function(t,n){var r=e("./locator");r.redirect(t,n)},n.prototype.reload=function(){var t=e("./locator");t.reload()},r.inherits(n,i),n}),define("core/eraction",["require","er/Action"],function(e){var t=e("er/Action"),n=new t;return n.on("enter",function(){var t=this.context.url,n=t.getPath(),r="view"+("/"==n?"/index":n),i=r+"/page";e([i],function(e){e.open(t.getQuery(),"ct")})}),n}),define("er/permission",[],function(){var e={},t={add:function(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];"object"==typeof r?this.add(r):e[n]=r}},isAllow:function(t){return!!e[t]}};return t}),define("er/URL",["require","./util"],function(e){function t(e,r,i){e=e||"/",r=r||"",i=i||"~",this.toString=function(){return r?e+i+r:e},this.getPath=function(){return e},this.getSearch=function(){return r};var o=null;this.getQuery=function(e){return o||(o=t.parseQuery(r)),e?o[e]:n.mix({},o)}}var n=e("./util");return t.parse=function(e,r){var i={querySeparator:"~"};r=n.mix(i,r);var o=e.indexOf(r.querySeparator);return o>=0?new t(e.slice(0,o),e.slice(o+1),r.querySeparator):new t(e,"",r.querySeparator)},t.withQuery=function(e,r,i){e+="";var o={querySeparator:"~"};i=n.mix(o,i);var a=e.indexOf(i.querySeparator)<0?i.querySeparator:"&",s=t.serialize(r),l=e+a+s;return t.parse(l,i)},t.parseQuery=function(e){for(var t=e.split("&"),n={},r=0;r<t.length;r++){var i=t[r];if(i){var o=i.indexOf("="),a=0>o?decodeURIComponent(i):decodeURIComponent(i.slice(0,o)),s=0>o?!0:decodeURIComponent(i.slice(o+1));n.hasOwnProperty(a)?s!==!0&&(n[a]=[].concat(n[a],s)):n[a]=s}}return n},t.serialize=function(e){if(!e)return"";var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(r)}return t.slice(1)},t.empty=new t,t}),define("er/router",["require","./URL","./events","./locator"],function(e){function t(t){for(var i=e("./URL").parse(t.url),o=i.getPath(),a=0;a<n.length;a++){var s=n[a];if(s.rule instanceof RegExp&&s.rule.test(o)||s.rule===o)return void s.handler.call(null,i)}r&&r.call(null,i),e("./events").fire("route",{url:i})}var n=[],r=null,i={add:function(e,t){n.push({rule:e,handler:t})},setBackup:function(e){r=e},start:function(){e("./locator").on("redirect",t)}};return i}),define("er/controller",["require","./permission","./Observable","./locator","./Deferred","./URL","./config","./events","./util","./assert","./router","./assert","./URL"],function(e){function t(t){if(!t)return!0;"string"==typeof t&&(t=t.split("|"));for(var n=e("./permission"),r=0;r<t.length;r++)if(n.isAllow(t[r]))return!0;return!1}function n(e){var r=e.url.getPath(),i=d[r];if(i&&i.movedTo){g.fire("actionmoved",{url:e.url,config:i,movedTo:i.movedTo});var o=h.parse(i.movedTo);return e.originalURL=e.url,e.url=o,n(e)}if(i&&i.childActionOnly&&!e.isChildAction&&(i=null),!i)return g.fire("actionnotfound",y.mix({failType:"NotFound",reason:"Not found"},e)),e.originalURL=e.url,e.url=h.parse(m.notFoundLocation),d[e.url.getPath()]?n(e):null;var a=t(i.authority);if(!a){g.fire("permissiondenied",y.mix({failType:"PermissionDenied",reason:"Permission denied",config:i},e));var s=i.noAuthorityLocation||m.noAuthorityLocation;return e.originalURL=e.url,e.url=h.parse(s),n(e)}return i}function r(e){var t=n(e);if("function"==typeof b.resolveActionConfig&&(t=b.resolveActionConfig(t,e)),!t){var r=new p;return r.syncModeEnabled=!1,r.reject("no action configured for url "+e.url.getPath()),r.promise}if(e.title=t.title,t.args)for(var i in t.args)t.args.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t.args[i]);var o=new p;o.syncModeEnabled=!1;var a=o.promise,s=!1;return a.abort=function(){s||(s=!0,g.fire("actionabort",y.mix({},e)))},e.isChildAction||(f=e.url),window.require([t.type],function(n){if(!s){if(!n){var r="No action implement for "+acrtionConfig.type,i=y.mix({failType:"NoModule",config:t,reason:r},e);return g.fire("actionfail",i),g.notifyError(i),void o.reject(r)}if("function"==typeof n)return void o.resolve(new n,e);var a=n;if("function"==typeof a.createRuntimeAction&&(a=a.createRuntimeAction(e),!a)){var r="Action factory returns non-action",i=y.mix({failType:"InvalidFactory",config:t,reason:r,action:a},e);return g.fire("actionfail",i),g.notifyError(i),void o.reject(r)}g.fire("actionloaded",{url:e.url,config:t,action:n}),o.resolve(a,e)}}),a}function i(e,t){if(!t.isChildAction){if(t.url!==f)return;v&&(g.fire("leaveaction",{action:v,to:y.mix({},t)}),"function"==typeof v.leave&&v.leave()),v=e,document.title=t.title||t.documentTitle||m.systemName}g.fire("enteraction",y.mix({action:e},t));var n=e.enter(t);return n.then(function(){g.fire("enteractioncomplete",y.mix({action:e},t))},function(e){var n="";e?e.message?(n=e.message,e.stack&&(n+="\n"+e.stack)):n=window.JSON&&"function"==typeof JSON.stringify?JSON.stringify(e):e:n="Invoke action.enter() causes error";var r=y.mix({failType:"EnterFail",reason:n},t);g.fire("enteractionfail",r),g.notifyError(r)}),n}function o(e,t,n,i){var o={url:e,container:t,isChildAction:!!i};if(i){var a=x[t];o.referrer=a?a.url:null}else o.referrer=f;y.mix(o,n);var s=r(o);return w.has(s,"loadAction should always return a Promise"),s}function a(e){"string"==typeof e&&(e=h.parse(e)),u&&"function"==typeof u.abort&&u.abort(),u=o(e,m.mainElement,null,!1),u.then(i).fail(y.bind(g.notifyError,g))}function s(e,t){var n=x[e.id];n&&(x[e.id]=void 0,n.action&&(t||(t={url:null,referrer:n.url,container:e.id,isChildAction:!0}),g.fire("leaveaction",{action:n.action,to:t}),"function"==typeof n.action.leave&&n.action.leave()))}function l(t,n,r,i){s(t,i);var o={url:i.url,action:n,hijack:r};x[t.id]=o;var a=e("./Observable");n instanceof a&&n.on("leave",function(){s(t)})}function c(t,n){function r(t,r,i){r=r||{};var o=e("./locator"),t=o.resolveURL(t,r);if(r.global){var a=document.getElementById(n.container);return a&&s(a),void o.redirect(t,r)}var l=x[n.container],c=t.toString()!==l.url.toString();(c||r.force)&&(r.silent?l.url=t:b.renderChildAction(t,n.container,i))}function o(e){e=e||window.event;var t=e.target||e.srcElement;if("a"===t.nodeName.toLowerCase()){var n=t.getAttribute("href",2)||"";if("#"===n.charAt(0)){e.preventDefault?e.preventDefault():e.returnValue=!1;var i=n.substring(1),o="global"===t.getAttribute("data-redirect");r(i,{global:o})}}}j[n.container]=null;var a=document.getElementById(n.container);return a?(t.redirect=r,t.reload=function(e){this.redirect(n.url,{force:!0},e)},l(a,t,o,n),i(t,n)):void 0}var u,d={},f=null,v=null,p=e("./Deferred"),h=e("./URL"),m=e("./config"),g=e("./events"),y=e("./util"),w=e("./assert"),b={registerAction:function(e){w.hasProperty(e,"path",'action config should contains a "path" property'),d[e.path]=e},start:function(){m.systemName||(m.systemName=document.title),e("./router").setBackup(a)},resolveActionConfig:function(e){return e}},x={};b.renderAction=a;var j={};return b.renderChildAction=function(t,n,r){var i=e("./assert");i.has(n),"string"==typeof t&&(t=e("./URL").parse(t));var a=j[n];a&&"function"==typeof a.abort&&a.abort();var s=o(t,n,r,!0),l=s.then(c,y.bind(g.notifyError,g));return l.abort=s.abort,j[n]=l,l},b}),define("er/main",["require","./controller","./router","./locator"],function(e){var t={version:"3.0.3",start:function(){e("./controller").start(),e("./router").start(),e("./locator").start()}};return t}),define("er",["er/main"],function(e){return e}),define("core/urlmap",["require","core/eraction","er/main","er/controller"],function(e){e("core/eraction");var t={},n={};return n.start=function(){e("er/main").start(),this.addmap("/"),this.addmap("/index")},n.addmap=function(n){var r=n.lastIndexOf("~");r>=0&&(n=n.substr(0,r));var i=[];i.push(n);for(var o=0;o<i.length;++o){var a=i[o];if(!t[a]){var s={path:a,type:"core/eraction"};e("er/controller").registerAction(s),t[a]=!0;var l="view"+("/"==a?"/index":a);mwt.log_debug("map url path [#"+a+"] to javascript "+l+"/page.js#open")}}},n}),define("core/BasePage",["require"],function(e){var t=function(e){this.id="index",this.name="首页",this.domid="";var t="",n=!1,r=null;e&&(e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.noPosNav&&(n=!0),e.posarr&&(r=e.posarr),e.passRoles&&(t=e.passRoles),this.domid="panel-"+this.id.replaceAll("/","-")),this.open=function(e,t){var n=(this.name,t);textblock.loading("loading...",n),this.execute(n,e)},this.execute=function(e,t){}};return t}),define("model/category",["require"],function(e){var t=null,n={};return n.syncLoad=function(e){return ajax.post("resource&action=getRootCategoryList",{},function(e){0!=e.retcode?mwt.alert(e.retmsg):t=e.data},!0),t},n.get=function(e){return t?t:n.syncLoad(e)},n}),define("view/index/list",["require"],function(e){var t,n,r,i={};return i.init=function(e){r=e,t=new mwt.Store({proxy:new mwt.HttpProxy({beforeLoad:store_before_load,afterLoad:store_after_load,url:ajax.getAjaxUrl("resource&action=query")})}),n=new MWT.Grid({render:r,cls:"mdown-rsc-grid",store:t,pagebar:!0,pageSize:20,multiSelect:!1,bordered:!1,noheader:!0,notoolbox:!0,position:"relative",bodyStyle:"",cm:new MWT.Grid.ColumnModel([{head:"",dataIndex:"icon",align:"left",width:70,render:function(e,t){return'<a href="'+t.actionUrl+'"><img class="rscicon" src="'+e+'"/></a>'}},{head:"",dataIndex:"regionId",align:"left",sort:!0,render:function(e,t){var n='<a class="title" href="'+t.actionUrl+'">'+t.title+'</a><p class="subtitle">'+t.info+'</p><p class="subtitle">分类: '+t.catename+"&nbsp;&nbsp;|&nbsp;&nbsp;大小: "+t.size+"&nbsp;&nbsp;|&nbsp;&nbsp;发布日期: "+t.ctime+"</p>";return n}},{head:"",dataIndex:"downnum",align:"right",width:90,style:"vertical-align:middle;",render:function(e,t){return'<p class="downnum">'+e+"次下载</p>"}},{head:"",dataIndex:"id",align:"right",width:100,style:"vertical-align:middle;",align:"right",render:function(e,t){var n="mwt-btn mwt-btn-success mwt-btn-sm",i=t.actionUrl,o='<a class="'+n+'" name="viewbtn-'+r+'" data-id="'+e+'" href="'+i+'"><i class="sicon-cloud-download"></i>下载</a>',a=[o];return a.join("&nbsp;&nbsp;")}}])}),t.on("load",function(){mwt.popinit()}),n.create()},i.query=function(e){t.baseParams=e,n.load()},i}),define("view/index/side",["require"],function(e){function t(e,t){if(t&&0!=t.length){for(var n=[],r=0;r<t.length;++r){var i=t[r],o=r+1,a='<li><a href="'+i.actionUrl+'"><i>'+o+"</i>"+i.title+"</a></li>";n.push(a)}var a='<ul class="rankul">'+n.join("")+"</ul>";jQuery("#"+e).html(a)}}var n,r,i,o={};return o.init=function(e){n=e,r="mdownnew-"+n,i="mdownhot-"+n},o.query=function(e){ajax.post("resource&action=topNew",{cateid:e.cateid},function(e){0!=e.retcode?textblock.danger(e.retmsg,r):t(r,e.data)}),ajax.post("resource&action=topHot",{cateid:e.cateid},function(e){0!=e.retcode?textblock.danger(e.retmsg,i):t(i,e.data)})},o}),define("view/index/toolbar",["require","model/category","./list","./side"],function(e){function t(t){var n=e("model/category").get();(0==n.length||0!=n[0].id)&&n.unshift({id:0,name:"全部"});for(var r=[],i=0;i<n.length;++i){var o=n[i],a=o.id==t?' class="active"':"",s='<li><a name="mdown-cate-a" href="javascript:;" data-cid="'+o.id+'"'+a+">"+o.name+"</a></li>";r.push(s)}return'<ul class="mdown-cateul">'+r.join("")+"</ul>"}var n={},r={cateid:0,key:""};return n.init=function(i,o){r.cateid=o.cateid?o.cateid:0,r.key=o.key?o.key:"";var a="<table><tr><th>资源分类：</th><td>"+t(r.cateid)+'</td></tr><tr><th style="padding-top:14px;">资源搜索：</th><td style="padding-top:14px;"><div class="mwt-search" style="border:none;"><input id="mdown-sokey" type="text" class="mwt-field" style="width:400px;height:30px;" placeholder="查询关键词" value="'+r.key+'"><i id="mdown-sokeybtn" class="icon icon-search" style="vertical-align:middle;"></i></div></td></tr></table>';jQuery("#"+i).html(a),e("./list").query(r),e("./side").query(r),jQuery("#mdown-sokey").unbind("change").change(n.go),jQuery("#mdown-sokeybtn").unbind("click").click(n.go),jQuery("[name=mdown-cate-a]").unbind("click").click(function(){r.cateid=jQuery(this).data("cid"),n.go()})},n.go=function(){r.key=mwt.get_value("mdown-sokey");var e="plugin.php?id=mdown:index#/~cateid="+r.cateid+"&key="+r.key;window.location=e},n}),define("view/index/page",["require","core/BasePage","model/category","./list","./side","./toolbar"],function(e){var t=e("core/BasePage"),n=(e("model/category"),new t({noPosNav:!0,name:"首页",id:"index"}));return n.execute=function(t,n){var r='<table class="mdown-tablay"><tr><td style="padding-right:10px;"><div class="mdown-panel" style="background:#f4f5f6;"><div class="mdown-body" id="mdown-tbar"></div></div><div class="mdown-panel"><div id="mdown-sores" class="mdown-body" style="min-height:400px;padding-bottom:0;">loading...</div></div></td><td width="250"><div class="mdown-panel"><div class="mdown-head">最新资源</div><div id="mdownnew-'+t+'" class="mdown-body">'+textblock.loading("loading...")+'</div></div><div class="mdown-panel"><div class="mdown-head">热门资源</div><div id="mdownhot-'+t+'" class="mdown-body">'+textblock.loading("loading...")+"</div></div></td></tr></table>";jQuery("#"+t).html(r),e("./list").init("mdown-sores"),e("./side").init(t),e("./toolbar").init("mdown-tbar",n)},n});var ajax,dict,posnav;define("jappengine",["require","core/ajax","common/dict","common/posnav","core/urlmap","view/index/page"],function(e){ajax=e("core/ajax"),dict=e("common/dict"),posnav=e("common/posnav");var t=e("core/urlmap"),n=[e("view/index/page")],r={};return r.start=function(){t.start();for(var e=0;e<n.length;++e){var r=n[e];t.addmap("/"+r.id)}},r});