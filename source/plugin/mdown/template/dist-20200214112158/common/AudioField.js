define(["require","./tts_dialog"],function(t){var e=function(e){function i(){r.hide(),d.value=mwt.get_value(n),d.fire("change"),""!=d.value&&jQuery("#"+n+"-clear").show()}function l(){var t=localStorage.getItem(s);if(t){var e=t.split("||");if(0!=e.length){for(var l='<div class="mwt-pop-words"><a id="'+this.render+'-pop-clrbtn" href="javascript:;">清空</a><ul id="'+this.render+'-wdul">',r=0;r<e.length;++r)l+='<li name="'+d.render+'-wd">'+e[r]+"</li>";l+="</ul></div>",jQuery("#"+c).show().html(l),jQuery("[name="+d.render+"-wd]").click(function(){var t=jQuery(this).html();jQuery("#"+n).val(t),i()}),jQuery("#"+this.render+"-pop-clrbtn").click(function(){d.clearwords(),jQuery("#"+this.render+"-wdul").html("")})}}}this.listeners={};var n,r,o,a,c,s,d=this,u="text",p="输入音频链接",h=!1,v="max-height:100px;";e&&(this.construct(e),e.type&&(u=e.type),e.placeholder&&(p=e.placeholder),e.errmsg&&(o=e.errmsg),e.checkfun&&(a=e.checkfun),e.empty&&(h=e.empty),n=this.render+"txt",c=this.render+"pop",e.popStyle&&(v=e.popStyle),s=this.render+"skey"),this.create=function(){var e=' style="height:26px;"',a='<div class="mwt-row mwt-row-flex"><div class="mwt-col-wd" style="width:40px;"><button id="playbtn-'+n+'" class="mwt-btn mwt-btn-default mwt-btn-xs" style="height:26px;color:#FF5722;padding-left:9px;border-color:#FF5722;font-size:12px;"><i class="sicon-control-play"></i></button><audio id="audio-'+n+'" src="" controls="controls" hidden="true"></audio></div><div class="mwt-col-fill"><div style="position:relative"><input type="'+u+'" id="'+n+'" class="form-control '+this.cls+'" placeholder="'+p+'" style="'+this.style+';padding:0 20px 0 5px;"><i id="'+n+'-clear" class="fa fa-times-circle" style="display:none;color:#999;font-size:14px;margin-left:-20px;vertical-align:middle;"></i></div></div><div class="mwt-col-wd" style="width:100px;padding-left:10px;"><div><button id="ttsbtn-'+n+'" class="mwt-btn mwt-btn-primary mwt-btn-xs"'+e+'>文字合成语音</button></div></div></div><div id="'+c+'" class="mwt-field-pop" style="'+v+'"></div>';jQuery("#"+this.render).html(a),r=new MWT.Popover({anchor:n,html:o,cls:"mwt-popover-danger"}),mwt.initImageView(),this.setValue(this.value);var s=jQuery("#"+n),h=jQuery("#"+n+"-clear"),m=jQuery("#"+c);s.change(i),s.focus(function(){h.show(),l(),jQuery(document).unbind("click").on("click",function(){var t=document.activeElement.id;t!=n&&(m.hide(),h.hide())}),event.stopPropagation()}),m.click(function(t){t.stopPropagation()}),h.click(function(){s.val("").focus()}),jQuery("#playbtn-"+n).unbind("click").on("click",d.play),jQuery("#ttsbtn-"+n).unbind("click").on("click",function(){t("./tts_dialog").open({},function(t){d.setValue(t)})})},this.setValue=function(t){mwt.set_value(n,t),this.value=t},this.validate=function(){r.hide();var t=h?mwt.get_value(n):mwt.get_text_value(n);return a&&!a(t)?(r.pop(),jQuery("#"+n).focus(),setTimeout(r.hide,2e3),!1):!0},this.readOnly=function(t){t?jQuery("#"+n).attr("readonly",!0):jQuery("#"+n).removeAttr("readonly")},this.clearwords=function(){localStorage.removeItem(s)},this.play=function(){var t=mwt.get_value(n);if(""!=t){var e=document.getElementById("audio-"+n);e.src=t,e.play()}}};return MWT["extends"](e,MWT.Field),e});