<?phpif(!defined('IN_DISCUZ') || !defined('IN_ADMINCP')) {	exit('Access Denied');}C::import('yunling_storage','plugin/yunling_storage/source/class');include_once DISCUZ_ROOT.'source/plugin/yunling_storage/source/Autoloader.php';$yunling_storage = new yunling_storage();$oss_config = $yunling_storage->config;$upload_path = $oss_config['upload_path'];$upload_path = trim($upload_path," \t\n\r\0\x0B/");$upload_path = substr($upload_path,-1,1) == '/'?$upload_path:($upload_path.'/');$tableid = $_GET['tableid'] ? $_GET['tableid'] + 0 : '0';if (!$_GET['attach_num']) {    $attach_num = $yunling_storage->get_type_attachment_num($tableid,array('remote'=>'1'));}else{    $attach_num = $_GET['attach_num'] + 0;}$perpage = $oss_config['acl_perpage']?$oss_config['acl_perpage']:200;$curpage = ($_GET['page'] + 0) > 0 ? ($_GET['page'] + 0) : 1;$mpurl=ADMINSCRIPT.'?action=plugins&operation=config&do=5&identifier=yunling_storage&pmod=update_acl';$pages= ceil($attach_num / $perpage);$start = $attach_num - ($attach_num - $perpage*$curpage+$perpage);if ($_GET['formhash'] == formhash()){    if ($attach_num > 0) {        $attachs = $yunling_storage->get_type_attachment($tableid,$start, $perpage, 'desc','',array('remote'=>'1'));        if (!empty($attachs)) {            foreach ($attachs as $key => $value) {                if ($value['isimage']) {                    $file = $upload_path.'forum/'.$value['attachment'];                    var_dump($file);                    $rs = $yunling_storage->set_remote_file_acl($file);                }            }            $current = 'forum_attachment_'.$tableid.'---step:'.$page.'('.$perpage.')';            ++$page;            $next =  'forum_attachment_'.$tableid.'---step:'.$page.'('.$perpage.')';            cpmsg('批量授权oss图片权限为public-read'.cplang('counter_processing', array('current' => $current, 'next' => $next)), 'action=plugins&operation=config&do=5&identifier=yunling_storage&pmod=update_acl&tableid='.$tableid.'&page='.$page.'&attach_num='.$attach_num.'&formhash='.FORMHASH, 'loading');        }    }    if ($tableid < 9) {        $current = 'forum_attachment_'.$tableid.'---step:'.$page.'('.$perpage.')';        $page = 0;        ++$tableid;        $next = 'forum_attachment_'.$tableid.'---step:'.$page.'('.$perpage.')';        cpmsg('批量授权oss图片权限为public-read'.cplang('counter_processing', array('current' => $current, 'next' => $next)), 'action=plugins&operation=config&do=5&identifier=yunling_storage&pmod=update_acl&tableid='.$tableid.'&page='.$page.'&attach_num='.$attach_num.'&formhash='.FORMHASH, 'loading');    }        cpmsg('成功','action=plugins&operation=config&do=5&identifier=yunling_storage&pmod=update_acl');}cpmsg('<label for="blockclasscache">批量授权oss图片权限为public-read</label>', 'action=plugins&operation=config&do=5&identifier=yunling_storage&pmod=update_acl', 'form', '', FALSE);