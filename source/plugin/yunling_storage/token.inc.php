<?phpif(!defined('IN_DISCUZ')) {	exit('Access Denied');}C::import('yunling_storage','plugin/yunling_storage/source/class');$yunling_storage = new yunling_storage();$oss_config = $yunling_storage->config;$upload_path = $oss_config['upload_path'];$upload_path = trim($upload_path," \t\n\r\0\x0B/");$upload_path = substr($upload_path,-1,1) == '/'?$upload_path:($upload_path.'/');$current = $_GET['current'] ? daddslashes($_GET['current']) : 'forum';$expiretime = TIMESTAMP + 360;$policy_data = array();$filepath = $upload_path.$current.'/'.$yunling_storage->get_target_dir($current,0);$policy_data['expiration'] = gmt_iso8601($expiretime);$policy_data['conditions'][] = array(0=>'content-length-range', 1=>0, 2=>1048576000);// $policy_data['conditions'][] = array(0=>'Content-Disposition',1=>'attachment;filename='.$_GET['filename']);// $policy_data['conditions'][] = array(0=>'starts-with', 1=>'$key', 2=>$filepath);$data = array();$data['OSSAccessKeyId'] = $oss_config['OSSAccessKeyId'];$data['policy'] = base64_encode(json_encode($policy_data));$data['expire'] = $expiretime;$data['expire'] = $expiretime;$data['apiselect'] = empty($yunling_storage -> config['apiselect'])?1:$yunling_storage -> config['apiselect'];$data['filepath'] = $filepath;$data['target_filename'] = $yunling_storage->get_target_filename($current,0,'');$data['host'] = $oss_config['host'];$data['key'] = $filepath.$data['target_filename'];$data['signature'] = base64_encode(hash_hmac('sha1', $data['policy'], $oss_config['AccessKeySecret'] , true));//生成认证签名echo json_encode($data);function gmt_iso8601($time) {    $dtStr = date("c", $time);    $mydatetime = new DateTime($dtStr);    $expiration = $mydatetime->format(DateTime::ISO8601);    $pos = strpos($expiration, '+');    $expiration = substr($expiration, 0, $pos);    return $expiration."Z";}