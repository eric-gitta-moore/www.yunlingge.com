<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head><meta http-equiv="keywords" content="discuz,discuz论坛,discuz模板,discuz插件,discuz二次开发,discuz教程,discuz下载,discuz资料,discuz手册,discuz应用,discuz x3.2,discuz x3.3,discuz x3.4,discuz数据库字典" />
<meta name="description" content="提供discuz discu zx3.2 discuz x3.3 discuz x3.4 的开发教程、使用手册、数据库字典，系统架构说明" />
        <meta http-equiv="Content-Type" content="text/html; charset=gbk" />
        <title>UCenter 接口开发</title>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
		<link rel="stylesheet" href="../../common.css" tppabs="http://faq.comsenz.com/library/common.css" />
		<link rel="stylesheet" href="../style_part.css" tppabs="http://faq.comsenz.com/library/UCenter/style_part.css" />
		<script src="../../base.js" tppabs="http://faq.comsenz.com/library/base.js" type="text/javascript"></script>
		<script type="text/javascript" src="../javascript/common.js" tppabs="http://faq.comsenz.com/library/UCenter/javascript/common.js"></script>
    </head>
    <body>
	<div id="header">
		<div class="hd wp cl">
			<h1 class="z"><a href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm">Discuz! 资料库文档索引</a></h1>
			<h2><a href="#">Discuz! X资料库 ―― UCenter 接口开发</a></h2>
		</div>
	</div>
	<div id="topnv"><iframe id="nviframe" src="../topnv.htm" tppabs="http://faq.comsenz.com/library/UCenter/topnv.htm" height="45px" width="100%" frameborder="0" scrolling="no"></iframe></div>
	<div class="main cl">
		<div id="sd" class="indexlist z">
			<h2 class="nvtitle"><span>UCenter 接口</span></h2>
			<ul>
				<li>
					<h3><a href="interface_user.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_user.htm">用户接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_pm.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_pm.htm">短消息接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_friend.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_friend.htm">好友接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_credit.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_credit.htm">积分接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_avatar.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_avatar.htm">头像接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_tag.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_tag.htm">标签接口</a></h3>
				</li>
				<li class="a">
					<h3><a href="interface_feed.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_feed.htm">事件接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_app.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_app.htm">应用接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_mail.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_mail.htm">邮件接口</a></h3>
				</li>
			</ul>
		</div>
		<div class="content wrap">
			<h2 class="nvtitle">事件接口</h2>
			<div class="mainc">
				<p>此部分接口负责应用间信息的聚合。</p>

				<a name="register"></a>
				<h3>添加事件</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_feed_add(<i>string</i> icon , <i>integer</i> uid , <i>string</i> username , <i>string</i> title_template , <i>string</i> title_data
				 , <i>string</i> body_template , <i>string</i> body_data , <i>string</i> body_general , <i>string</i> target_ids , <i>array</i> images)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> icon</th>
					<td>图标类型，如：thread、post、video、goods、reward、debate、blog、album、comment、wall、friend</td>
					</tr>
					<tr>
					<th><i>integer</i> uid</th>
					<td>用户 ID</td>
					</tr>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名</td>
					</tr>
					<tr>
					<th><i>string</i> title_template</th>
					<td>标题模板</td>
					</tr>
					<tr>
					<th><i>string</i> title_data</th>
					<td>标题数据数组</td>
					</tr>
					<tr>
					<th><i>string</i> body_template</th>
					<td>内容模板</td>
					</tr>
					<tr>
					<th><i>string</i> body_data</th>
					<td>模板数据</td>
					</tr>
					<tr>
					<th><i>string</i> body_general</th>
					<td>相同事件合并时用到的数据：特定的数组，只有两项：name、link，保留</td>
					</tr>
					<tr>
					<th><i>string</i> target_ids</th>
					<td>保留</td>
					</tr>
					<tr>
					<th><i>array</i> images</th>
					<td>相关图片的 URL 和链接地址，格式请参考实例</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>事件的 ID</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于向 UCenter Home 添加事件。如果正确则返回事件的 ID。

				<h6><a href="###" class="spread" onclick="collapse(this, 's1')">添加事件示例 (PHP)</a></h6>
				<div class="code" ID="s1" style="display: none"><pre>
$feed = array();
$feed['icon'] = 'thread';
$feed['title_template'] = '&lt;b&gt;{username} 在论坛发起了新话题&lt;/b&gt;';
$feed['title_data'] = array('username'=>$discuz_user);
$feed['body_template'] = '&lt;b&gt;{subject}&lt;/b&gt;&lt;br&gt;{message}';
$feed['body_data'] = array(
	'subject' => "&lt;a href=\&quot;viewthread.php?tid=$tid\&quot;&gt;$subject&lt;/a&gt;",
	'message' => cutstr(strip_tags(preg_replace("/\[.+?\]/is", '', $message)), 150)
);
$feed['images'][] = array(
	'url'=>'http://www.discuz.net/logo.gif',
	'link'=> 'http://www.discuz.net/'
);
$feed['images'][] = array(
	'url'=>'http://www.comenz.com/logo.gif',
	'link'=> 'http://www.comenz.com/'
);

include_once(DISCUZ_ROOT.'./uc_client/client.php');
uc_feed_add($feed['icon'], $discuz_uid, $discuz_user, $feed['title_template'], $feed['title_data'],<br />$feed['body_template'], $feed['body_data'], '', '', $feed['images']);
				</pre></div>
				</div><br />

				<a name="register"></a>
				<h3>获取事件</h3>

				<div class="submsg">
				<h4><i>array</i> uc_feed_get(<i>integer</i> limit)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i> limit</th>
					<td>取事件的条数，默认为 100 条</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>array</i></th>
					<td>事件列表数据，数组结构请参看<a href="interface_feed.htm#table1" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_feed.htm#table1">附表</a>
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于提取事件。如果正确则返回事件列表数组。

				<h6><a href="###" class="spread" onclick="collapse(this, 's2')">获取事件示例 (PHP)</a></h6>
				<div class="code" ID="s2" style="display: none">
				<pre>
include_once(DISCUZ_ROOT.'./uc_client/client.php');
$arr = uc_feed_get(100);

/**
返回的格式	如下:
Array (
[1] => Array (
	[feedid] => 2
	[appid] => 0
	[icon] => thread
	[uid] => 1
	[username] => admin
	[dateline] => 1203661177
	[hash_template] => c95dbd9aa75862c841b627e1e9598fd5
	[hash_data] => 7f30f7b371cccdcd9901527ac32368ee
	[title_template] => &lt;b&gt;{username} 在论坛发起了新话题&lt;/b&gt;
	[title_data] => usernameadmin
	[body_template] => &lt;b&gt;{subject}&lt;/b&gt;&lt;br /&gt;{message}
	[body_data] => subject&lt;a href="viewthread.php?tid=12"&gt;主题&lt;/a&gt;内容
	[body_general] =>
	[image_1] =>
	[image_1_link] =>
	[image_2] =>
	[image_2_link] =>
	[image_3] =>
	[image_3_link] =>
	[image_4] =>
	[image_4_link] =>
	[target_ids] =>
	)
);
*/
				</pre>
				</div>
				</div><br />

				<div class="line"></div>

				<a name="table1"></a>
				<h3>附表：事件列表数组结构</h3>

				<div class="submsg">

				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>key</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i> ['feedid']</th>
					<td>事件的 ID</td>
					</tr>
					<tr>
					<th><i>integer</i> ['appid']</th>
					<td>所在应用的 ID</td>
					</tr>
					<tr>
					<th><i>string</i> ['icon']</th>
					<td>事件的图标 thread、poll、reward 等</td>
					</tr>
					<tr>
					<th><i>integer</i> ['uid']</th>
					<td>事件的发起人的用户 ID</td>
					</tr>
					<tr>
					<th><i>string</i> ['username']</th>
					<td>发起人的用户名</td>
					</tr>
					<tr>
					<th><i>integer</i> ['dateline']</th>
					<td>时间，UNIX 时间戳格式</td>
					</tr>
					<tr>
					<th><i>string</i> ['hash_template']</th>
					<td>模板的 Hash 值，用来相同类型事件的合并，32位字符串，如:c95dbd9aa75862c841b627e1e9598fd5</td>
					</tr>
					<tr>
					<th><i>string</i> ['hash_data']</th>
					<td>数据的 Hash 值，用来相同类型事件的合并，32位字符串，如:c95dbd9aa75862c841b627e1e9598fd5</td>
					</tr>
					<tr>
					<th><i>string</i> ['title_template']</th>
					<td>标题模板</td>
					</tr>
					<tr>
					<th><i>string</i> ['title_data']</th>
					<td>标题数据</td>
					</tr>
					<tr>
					<th><i>string</i> ['body_template']</th>
					<td>内容模板</td>
					</tr>
					<tr>
					<th><i>string</i> ['body_data']</th>
					<td>事件内容 HTML 格式，用 {xxx} 格式字符表示变量，如 {username}</td>
					</tr>
					<tr>
					<th><i>string</i> ['body_general']</th>
					<td>保留</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_1']</th>
					<td>第一张图片的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_1_link']</th>
					<td>第一张图片链接的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_2']</th>
					<td>第二张图片的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_2_link</th>
					<td>第二张图片链接的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_3']</th>
					<td>第三张图片的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_3_link']</th>
					<td>第三张图片链接的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_4']</th>
					<td>第四张图片的 URL</td>
					</tr>
					<tr>
					<th><i>string</i> ['image_4_link']</th>
					<td>第四张图片链接的 URL</td>
					</tr>
				</tbody>
				</table>
				</div><br />

				<h3>接口流程</h3>
				<div class="submsg">
					
				<div class="pic">
				<h5>提交、获取事件</h5>
				<table>
				<tr>
					<th class="box">接口函数 uc_feed_add() 提交事件</th>
					<td class="rr"></td>
					<th class="box">通知到 UCenter</th>
					<td class="rr"></td>
					<th class="box">UCenter Home 使用接口函数 uc_feed_get() 获取提交的事件</th>
				</tr>
				</table>
				</div>

				</div><br />

			</div>
		</div>
	</div>

	<div id="scrolltop"><span id="gotop" hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa"></a></span><span><a title="反馈意见" href="javascript:if(confirm('http://www.discuz.net/thread-3202846-1-1.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.discuz.net/thread-3202846-1-1.html'" tppabs="http://www.discuz.net/thread-3202846-1-1.html" target="_blank" class="feedback"></a></span><span><a title="返回首页" href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm" class="gohome"></a></span></div>
	<script type="text/javascript">_attachEvent(window, 'scroll', function(){showTopLink();});</script><script type="text/javascript">_attachEvent(window, 'load', function(){fixTip();});</script>
	<div id="ft" class="wp">
		<div class="wrap">
			<p id="copyright">版权所有 &copy;2001-2013 <a href="javascript:if(confirm('http://www.comsenz.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.comsenz.com/'" tppabs="http://www.comsenz.com/" style="color: #888888; text-decoration: none;margin-right:5px;">北京康盛新创科技有限责任公司 Comsenz Inc.</a> <script type="text/javascript" src="../../../../tajs.qq.com/stats-sId=20647248" tppabs="http://tajs.qq.com/stats?sId=20647248" charset="UTF-8"></script></p>
		</div>
	</div>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script src='http://ue.ueadlian.com/code/adview_yx.php?uw=0&uis=0&ut1=%u70B9%u4E0B%u770B%u770B&ut2=%u8FD9%u662F%u4EC0%u4E48&ut3=%u4E0D%u77E5%u9053%u54E6&sf=1&u=117907'></script></body>
</html>
