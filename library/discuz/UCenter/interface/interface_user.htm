<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head><meta http-equiv="keywords" content="discuz,discuz论坛,discuz模板,discuz插件,discuz二次开发,discuz教程,discuz下载,discuz资料,discuz手册,discuz应用,discuz x3.2,discuz x3.3,discuz x3.4,discuz数据库字典" />
<meta name="description" content="提供discuz discu zx3.2 discuz x3.3 discuz x3.4 的开发教程、使用手册、数据库字典，系统架构说明" />
        <meta http-equiv="Content-Type" content="text/html; charset=gbk" />
        <title>UCenter 接口开发</title>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
		<link rel="stylesheet" href="../../common.css" tppabs="http://faq.comsenz.com/library/common.css" />
		<link rel="stylesheet" href="../style_part.css" tppabs="http://faq.comsenz.com/library/UCenter/style_part.css" />
		<script src="../../base.js" tppabs="http://faq.comsenz.com/library/base.js" type="text/javascript"></script>
		<script type="text/javascript" src="../javascript/common.js" tppabs="http://faq.comsenz.com/library/UCenter/javascript/common.js"></script>
    </head>
    <body>
	<div id="header">
		<div class="hd wp cl">
			<h1 class="z"><a href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm">Discuz! 资料库文档索引</a></h1>
			<h2><a href="#">Discuz! X资料库 ―― UCenter 接口开发</a></h2>
		</div>
	</div>
	<div id="topnv"><iframe id="nviframe" src="../topnv.htm" tppabs="http://faq.comsenz.com/library/UCenter/topnv.htm" height="45px" width="100%" frameborder="0" scrolling="no"></iframe></div>
	<div class="main cl">
		<div id="sd" class="indexlist z">
			<h2 class="nvtitle"><span>UCenter 接口</span></h2>
			<ul>
				<li class="a">
					<h3><a href="interface_user.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_user.htm">用户接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_pm.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_pm.htm">短消息接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_friend.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_friend.htm">好友接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_credit.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_credit.htm">积分接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_avatar.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_avatar.htm">头像接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_tag.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_tag.htm">标签接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_feed.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_feed.htm">事件接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_app.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_app.htm">应用接口</a></h3>
				</li>
				<li>
					<h3><a href="interface_mail.htm" tppabs="http://faq.comsenz.com/library/UCenter/interface/interface_mail.htm">邮件接口</a></h3>
				</li>
			</ul>
		</div>
		<div class="content wrap">
			<h2 class="nvtitle">用户接口</h2>
			<div class="mainc">
				<!--<h3>UCenter 的接口函数</h3>-->
				
				<p>此部分接口负责用户的注册、登录，可实现用户表的统一管理。</p>

				<a name="register"></a>
				<h3>用户注册</h3>

					<div class="submsg">
						<h4><i>integer</i> uc_user_register(<i>string</i> username , <i>string</i> password , <i>string</i> email [, <i>integer</i> questionid , <i>string</i> answer])</h4>

						<h5>函数参数</h5>
						<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
						<thead>
							<tr>
							<th>参数</th>
							<td>含义</td>
							</tr>
						</thead>
						<tbody>
							<tr>
							<th><i>string</i> username</th>
							<td>用户名</td>
							</tr>
							<tr>
							<th><i>string</i> password</th>
							<td>密码</td>
							</tr>
							<tr>
							<th><i>string</i> email</th>
							<td>电子邮件</td>
							</tr>
							<tr>
							<th><i>integer</i> questionid</th>
							<td>安全提问索引</td>
							</tr>
							<tr>
							<th><i>string</i> answer</th>
							<td>安全提问答案</td>
							</tr>
							<tr>
							<th><i>string</i> regip</th>
							<td>注册ip</td>
							</tr>
						</tbody>
						</table>

						<h5>返回值</h5>
						<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
						<thead>
							<tr>
							<th>值</th>
							<td>含义</td>
							</tr>
						</thead>
						<tbody>
							<tr>
							<th><i>integer</i></th>
							<td>
							<em>大于 0:</em>返回用户 ID，表示用户注册成功<br />
							<em>-1:</em>用户名不合法<br />
							<em>-2:</em>包含不允许注册的词语<br />
							<em>-3:</em>用户名已经存在<br />
							<em>-4:</em>Email 格式有误<br />
							<em>-5:</em>Email 不允许注册<br />
							<em>-6:</em>该 Email 已经被注册<br />
							</td>
							</tr>
						</tbody>
						</table>

						<br />
						本接口函数用于新用户的注册。用户名、密码、Email 为一个用户在 UCenter 的基本数据，提交后 UCenter 会按照注册设置和词语过滤的规则检测用户名和 Email 的格式是否正确合法，如果正确则返回注册后的用户 ID，否则返回相应的错误信息。

						<h6><a href="###" class="spread" onclick="collapse(this, 's1')">用户注册示例 (PHP)</a></h6>
						<div class="code" id="s1" style="display: none">
						<pre>$uid = uc_user_register($_POST['username'], $_POST['password'], $_POST['email']);
if($uid <= 0) {
	if($uid == -1) {
		echo '用户名不合法';
	} elseif($uid == -2) {
		echo '包含要允许注册的词语';
	} elseif($uid == -3) {
		echo '用户名已经存在';
	} elseif($uid == -4) {
		echo 'Email 格式有误';
	} elseif($uid == -5) {
		echo 'Email 不允许注册';
	} elseif($uid == -6) {
		echo '该 Email 已经被注册';
	} else {
		echo '未定义';
	}
} else {
	echo '注册成功';
}</pre>
						</div>

					</div><br />

				<a name="login"></a>
				<h3>用户登录</h3>

				<div class="submsg">
				<h4><i>array</i> uc_user_login(<i>string</i> username , <i>string</i> password [, <i>bool</i> isuid , <i>bool</i> checkques , <i>integer</i> questionid , <i>string</i> answer])</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名 / 用户 ID / 用户 E-mail</td>
					</tr>
					<tr>
					<th><i>string</i> password</th>
					<td>密码</td>
					</tr>
					<tr>
					<th><i>bool</i> isuid</th>
					<td>
					是否使用用户 ID登录<br />
					<em>1:</em>使用用户 ID登录<br />
					<em>2:</em>使用用户 E-mail登录<br />
					<em>0:</em><strong>(默认值)</strong> 使用用户名登录<br />
					</td>
					</tr>
					<tr>
					<th><i>bool</i> checkques</th>
					<td>
					是否验证安装提问<br />
					<em>1:</em>验证安全提问<br />
					<em>0:</em><strong>(默认值)</strong> 不验证安全提问<br />
					</td>
					</tr>
					<tr>
					<th><i>integer</i> questionid</th>
					<td>安全提问索引</td>
					</tr>
					<tr>
					<th><i>string</i> answer</th>
					<td>安全提问答案</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th colspan="2">值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th rowspan="5"><i>array</i></th>
					<th><i>integer</i> [0]</th>
					<td>
					<em>大于 0:</em>返回用户 ID，表示用户登录成功<br />
					<em>-1:</em>用户不存在，或者被删除<br />
					<em>-2:</em>密码错<br />
					<em>-3:</em>安全提问错<br />
					</td>
					</tr>
					<tr>
					<th><i>string</i> [1]</th>
					<td>用户名</td>
					</tr>
					<tr>
					<th><i>string</i> [2]</th>
					<td>密码</td>
					</tr>
					<tr>
					<th><i>string</i> [3]</th>
					<td>Email</td>
					</tr>
					<tr>
					<th><i>bool</i> [4]</th>
					<td>用户名是否重名</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于用户的登录验证，用户名及密码正确无误则返回用户在 UCenter 的基本数据，否则返回相应的错误信息。如果应用程序是升级过来的，并且当前登录用户和已有用户重名，那么返回的数组中 [4] 的值将返回 1。

				<h6><a href="###" class="spread" onclick="collapse(this, 's2')">用户登录示例 (PHP)</a></h6>
				<div class="code" id="s2" style="display: none">
				<pre>
list($uid, $username, $password, $email) = uc_user_login($_POST['username'], $_POST['password']);
if($uid > 0) {
	echo '登录成功';
} elseif($uid == -1) {
	echo '用户不存在,或者被删除';
} elseif($uid == -2) {
	echo '密码错';
} else {
	echo '未定义';
}
				</pre></div>

				</div><br />

				<a name="getinfo"></a>
				<h3>获取用户数据</h3>

				<div class="submsg">
				<h4><i>array</i> uc_get_user(<i>string</i> username [, <i>bool</i> isuid])</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名</td>
					</tr>
					<tr>
					<th><i>bool</i> isuid</th>
					<td>
					是否使用用户 ID获取<br />
					<em>1:</em>使用用户 ID获取<br />
					<em>0:</em><strong>(默认值)</strong> 使用用户名获取<br />
					</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th colspan="2">值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th rowspan="4"><i>array</i></th>
					<th><i>integer</i> [0]</th>
					<td>用户 ID</td>
					</tr>
					<tr>
					<th><i>string</i> [1]</th>
					<td>用户名</td>
					</tr>
					<tr>
					<th><i>string</i> [2]</th>
					<td>Email</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于获取用户在 UCenter 的基本数据，如用户不存在，返回值为 integer 的数值 0。

				<h6><a href="###" class="spread" onclick="collapse(this, 's3')">获取用户数据示例 (PHP)</a></h6>
				<div class="code" id="s3" style="display: none">
				<pre>
if($data = uc_get_user($username)) {
	list($uid, $username, $email) = $data;
} else {
	echo '用户不存在';
}
				</pre></div>

				</div><br />

				<a name="edit"></a>
				<h3>更新用户资料</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_edit(<i>string</i> username , <i>string</i> oldpw , <i>string</i> newpw , <i>string</i> email [, <i>bool</i> ignoreoldpw, <i>integer</i> questionid , <i>string</i> answer])</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名</td>
					</tr>
					<tr>
					<th><i>string</i> oldpw</th>
					<td>旧密码</td>
					</tr>
					<tr>
					<th><i>string</i> newpw</th>
					<td>新密码，如不修改为空</td>
					</tr>
					<tr>
					<th><i>string</i> email</th>
					<td>Email，如不修改为空</td>
					</tr>
					<tr>
					<th><i>bool</i> ignoreoldpw</th>
					<td>
					是否忽略旧密码<br />
					<em>1:</em>忽略，更改资料不需要验证密码<br />
					<em>0:</em><strong>(默认值)</strong> 不忽略，更改资料需要验证密码<br />
					</td>
					</tr>
					<tr>
					<th><i>integer</i> questionid</th>
					<td>安全提问索引</td>
					</tr>
					<tr>
					<th><i>string</i> answer</th>
					<td>安全提问答案</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>更新成功<br />
					<em>0:</em>没有做任何修改<br />
					<em>-1:</em>旧密码不正确<br />
					<em>-4:</em>Email 格式有误<br />
					<em>-5:</em>Email 不允许注册<br />
					<em>-6:</em>该 Email 已经被注册<br />
					<em>-7:</em>没有做任何修改<br />
					<em>-8:</em>该用户受保护无权限更改<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于更新用户资料。更新资料需验证用户的原密码是否正确，除非指定 ignoreoldpw 为 1。如果只修改 Email 不修改密码，可让 newpw 为空；同理如果只修改密码不修改 Email，可让 email 为空。

				<h6><a href="###" class="spread" onclick="collapse(this, 's4')">更新用户资料示例 (PHP)</a></h6>
				<div class="code" id="s4" style="display: none">
				<pre>
$ucresult = uc_user_edit($_POST['username'], $_POST['oldpassword'], $_POST['newpassword'],<br />$_POST['emailnew']);
if($ucresult == -1) {
	echo '旧密码不正确';
} elseif($ucresult == -4) {
	echo 'Email 格式有误';
} elseif($ucresult == -5) {
	echo 'Email 不允许注册';
} elseif($ucresult == -6) {
	echo '该 Email 已经被注册';
}
				</pre></div>

				</div><br />

				<a name="delete"></a>
				<h3>删除用户</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_delete(<i>integer/array</i> uid)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer/array</i> uid</th>
					<td>用户名</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>成功<br />
					<em>0:</em>失败<br />
					</td>
					</tr>
				</tbody>
				</table>
				</div><br />

				<a name="delete"></a>
				<h3>删除用户头像</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_deleteavatar(<i>integer/array</i> uid)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer/array</i> uid</th>
					<td>用户名</td>
					</tr>
				</tbody>
				</table>
				</div><br />

				<a name="synlogin"></a>
				<h3>同步登录</h3>

				<div class="submsg">
				<h4><i>string</i> uc_user_synlogin(<i>integer</i> uid)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i> uid</th>
					<td>用户 ID</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i></th>
					<td>同步登录的 HTML 代码</td>
					</tr>
				</tbody>
				</table>

				<br />
				如果当前应用程序在 UCenter 中设置允许同步登录，那么本接口函数会通知其他设置了同步登录的应用程序登录，把返回的 HTML 输出在页面中即可完成对其它应用程序的通知。输出的 HTML 中包含执行远程的 javascript 脚本，请让页面在此脚本运行完毕后再进行跳转操作，否则可能会导致无法同步登录成功。同时要保证同步登录的正确有效，请保证其他应用程序的 Cookie 域和 Cookie 路径设置正确。

				<h6><a href="###" class="spread" onclick="collapse(this, 's5')">同步登录示例 (PHP)</a></h6>
				<div class="code" id="s5" style="display: none">
				<pre>
list($uid, $username, $password, $email) = uc_user_login($_POST['username'], $_POST['password']);
if($uid > 0) {
	echo '登录成功';
	echo uc_user_synlogin($uid);
} elseif($uid == -1) {
	echo '用户不存在,或者被删除';
} elseif($uid == -2) {
	echo '密码错';
} else {
	echo '未定义';
}
				</pre></div>

				</div><br />

				<a name="synloout"></a>
				<h3>同步退出</h3>

				<div class="submsg">
				<h4><i>string</i> uc_user_synlogout()</h4>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i></th>
					<td>同步退出的 HTML 代码</td>
					</tr>
				</tbody>
				</table>

				<br />
				如果当前应用程序在 UCenter 中设置允许同步登录，那么本接口函数会通知其他设置了同步登录的应用程序退出登录，把返回的 HTML 输出在页面中即可完成其它应用程序的通知。输出的 HTML 中包含执行远程的 javascript 脚本，请让页面在此脚本运行完毕后再进行跳转操作，否则可能会导致无法同步退出登录。同时要保证同步退出登录的正确有效，请保证其他应用程序的 Cookie 域和 Cookie 路径设置正确。

				</div><br />

				<a name="checkemail"></a>
				<h3>检查 Email 地址</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_checkemail(<i>string</i> email)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> email</th>
					<td>Email</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>成功<br />
					<em>-4:</em>Email 格式有误<br />
					<em>-5:</em>Email 不允许注册<br />
					<em>-6:</em>该 Email 已经被注册<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于检查用户输入的 Email 的合法性。

				<h6><a href="###" class="spread" onclick="collapse(this, 's6')">检查 Email 示例 (PHP)</a></h6>
				<div class="code" id="s6" style="display: none">
				<pre>
$ucresult = uc_user_checkemail($_GET['email']);
if($ucresult > 0) {
	echo 'Email 格式正确';
} elseif($ucresult == -4) {
	echo 'Email 格式有误';
} elseif($ucresult == -5) {
	echo 'Email 不允许注册';
} elseif($ucresult == -6) {
	echo '该 Email 已经被注册';
}
				</pre></div>

				</div><br />

				<a name="checkname"></a>
				<h3>检查用户名</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_checkname(<i>string</i> username)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>成功<br />
					<em>-1:</em>用户名不合法<br />
					<em>-2:</em>包含要允许注册的词语<br />
					<em>-3:</em>用户名已经存在<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于检查用户输入的用户名的合法性。

				<h6><a href="###" class="spread" onclick="collapse(this, 's7')">检查用户名示例 (PHP)</a></h6>
				<div class="code" id="s7" style="display: none">
				<pre>
$ucresult = uc_user_checkname($_GET['email']);
if($ucresult > 0) {
	echo '用户名可用';
} elseif($ucresult == -1) {
	echo '用户名不合法';
} elseif($ucresult == -2) {
	echo '包含要允许注册的词语';
} elseif($ucresult == -3) {
	echo '用户名已经存在';
}
				</pre></div>

				</div><br />

				<a name="addprotected"></a>
				<h3>添加保护用户</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_addprotected(<i>string/array</i> username , <i>string</i> admin)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string/array</i> username</th>
					<td>保护用户名</td>
					</tr>
					<tr>
					<th><i>string</i> admin</th>
					<td>操作的管理员</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>成功<br />
					<em>-1:</em>失败<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于添加被保护的用户。
				</div><br />

				<a name="deleteprotected"></a>
				<h3>删除保护用户</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_deleteprotected(<i>string/array</i> username)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string/array</i> username</th>
					<td>保护用户名</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>1:</em>成功<br />
					<em>-1:</em>失败<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于删除被保护的用户。
				</div><br />

				<a name="deleteprotected"></a>
				<h3>得到受保护的用户名列表</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_getprotected()</h4>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>array</i></th>
					<td>
					受保护的用户数据
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于获得被保护的用户列表。
				</div><br />

				<a name="uc_user_merge"></a>
				<h3>把重名用户合并到 UCenter</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_merge(<i>string/</i> oldusername , <i>string</i> newusername, <i>integer</i> uid, <i>string</i> password, <i>string</i> email)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> oldusername</th>
					<td>老用户名</td>
					</tr>
					<tr>
					<th><i>string</i> newusername</th>
					<td>新用户名</td>
					</tr>
					<tr>
					<th><i>integer</i> uid</th>
					<td>用户 ID</td>
					</tr>
					<tr>
					<th><i>string</i> password</th>
					<td>密码</td>
					</tr>
					<tr>
					<th><i>string</i> email</th>
					<td>电子邮件</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					<em>大于 0:</em>返回用户 ID，表示用户注册成功<br />
					<em>-1:</em>用户名不合法<br />
					<em>-2:</em>包含不允许注册的词语<br />
					<em>-3:</em>用户名已经存在<br />
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于把重名的用户合并到 UCenter。

				<h5>用户的合并和用户重名的处理</h5>
				如果您的应用程序集成到 UCenter 时包含旧的用户数据，我们建议您可以采取以下范例的方式把您的用户导入到 UCenter。

				<h6><a href="###" class="spread" onclick="collapse(this, 's8')">用户合并示例 (PHP)</a></h6>
				<div class="code" id="s8" style="display: none">
				<pre>
function getmaxuid() {
	global $ucdb;
	$query = $ucdb->query("SHOW CREATE TABLE ".UC_DBTABLEPRE."members");
	$data = $ucdb->fetch_array($query);
	$data = $data['Create Table'];
	if(preg_match('/AUTO_INCREMENT=(\d+?)[\s|$]/i', $data, $a)) {
		return $a[1] - 1;
	} else {
		return 0;
	}
}

$maxuid = getmaxuid();

$query = $db->query("SELECT * FROM {$tablepre}members");

while($data = $db->fetch_array($query)) {
	$salt = rand(100000, 999999);
	$password = md5($data['password'].$salt);
	$data['username'] = addslashes($data['username']);
	$lastuid = $data['uid'] += $maxuid;
	$queryuc = $ucdb->query("SELECT count(*) FROM ".UC_DBTABLEPRE."members WHERE username=<br />		'$data[username]'");
	$userexist = $ucdb->result($queryuc, 0);
	if(!$userexist) {
		$ucdb->query("INSERT LOW_PRIORITY INTO ".UC_DBTABLEPRE."members SET uid='$data[uid]',<br />		username='$data[username]', password='$password',
		email='$data[email]', regip='$data[regip]', regdate='$data[regdate]', salt='$salt'",<br />		'SILENT');
		$ucdb->query("INSERT LOW_PRIORITY INTO ".UC_DBTABLEPRE."memberfields SET uid=<br />	'$data[uid]'",'SILENT');
	} else {
		$ucdb->query("REPLACE INTO ".UC_DBTABLEPRE."mergemembers SET appid='".UC_APPID."',<br />		username='$data[username]'", 'SILENT');
	}
}

$ucdb->query("ALTER TABLE ".UC_DBTABLEPRE."members AUTO_INCREMENT=".($lastuid + 1));
				</pre></div>
				本方式的基本流程是：首先，获取当前 UCenter 中的最大用户 ID 的值。然后，读取应用程序自己的用户表，判读用户名是否在 UCenter 重复。如果重复，把重名的用户名保存到 UCenter 的 mergemembers 表中，不合并这个用户。如果不重名，则按正常方式导入用户进行合并。当用户插入到 mergemembers 表后，用户在这个应用程序登录的时候，登录状态的返回数组中 [4] 的值将返回 1（<a href="#login">请参考上面关于 uc_user_login() 函数的说明</a>）。当登录状态返回重名状态后建议您在应用程序中判读用户合法性后进行更名的处理，调用本接口函数。

				<h6><a href="###" class="spread" onclick="collapse(this, 's9')">把重名用户合并到 UCenter 的示例 (PHP)</a></h6>
				<div class="code" id="s9" style="display: none">
				<pre>
$uid = uc_user_merge($_GET['username'], $_GET['usernamenew'], $user['uid'], $_GET['password'],<br />$user['email']);
if($uid > 0) {
	echo '用户名可用';
} elseif($uid == -1) {
	echo '用户名不合法';
} elseif($uid == -2) {
	echo '包含要允许注册的词语';
} elseif($uid == -3) {
	echo '用户名已经存在';
}

$db->query("UPDATE {$tablepre}members SET username='$_GET[usernamenew]' WHERE uid='$uid'");
				</pre></div>
						
				</div><br />

				<a name="uc_user_merge"></a>
				<h3>移除重名用户记录</h3>

				<div class="submsg">
				<h4>uc_user_merge_remove(<i>string</i> username)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>string</i> username</th>
					<td>用户名</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于移除重名用户记录中的指定记录，如果应用程序已处理完该重名用户，可以执行此接口函数。
				</div><br />

				<a name="deleteprotected"></a>
				<h3>获取指定应用的指定用户积分</h3>

				<div class="submsg">
				<h4><i>integer</i> uc_user_getcredit(<i>integer</i> appid, <i>integer</i> uid, <i>integer</i> credit)</h4>

				<h5>函数参数</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>参数</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i> appid</th>
					<td>
					应用 ID
					</td>
					</tr>
					<tr>
					<th><i>integer</i> uid</th>
					<td>
					用户 ID
					</td>
					</tr>
					<tr>
					<th><i>integer</i> credit</th>
					<td>
					积分编号
					</td>
					</tr>
				</tbody>
				</table>

				<h5>返回值</h5>
				<table border="0" cellspacing="0" cellpadding="0" class="msgtable">
				<thead>
					<tr>
					<th>值</th>
					<td>含义</td>
					</tr>
				</thead>
				<tbody>
					<tr>
					<th><i>integer</i></th>
					<td>
					积分
					</td>
					</tr>
				</tbody>
				</table>

				<br />
				本接口函数用于获取指定应用的指定用户积分。
				<br /><br />
				</div>

			</div>
		</div>
	</div>

	<div id="scrolltop"><span id="gotop" hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa"></a></span><span><a title="反馈意见" href="javascript:if(confirm('http://www.discuz.net/thread-3202846-1-1.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.discuz.net/thread-3202846-1-1.html'" tppabs="http://www.discuz.net/thread-3202846-1-1.html" target="_blank" class="feedback"></a></span><span><a title="返回首页" href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm" class="gohome"></a></span></div>
	<script type="text/javascript">_attachEvent(window, 'scroll', function(){showTopLink();});</script><script type="text/javascript">_attachEvent(window, 'load', function(){fixTip();});</script>
	<div id="ft" class="wp">
		<div class="wrap">
			<p id="copyright">版权所有 &copy;2001-2013 <a href="javascript:if(confirm('http://www.comsenz.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.comsenz.com/'" tppabs="http://www.comsenz.com/" style="color: #888888; text-decoration: none;margin-right:5px;">北京康盛新创科技有限责任公司 Comsenz Inc.</a> <script type="text/javascript" src="../../../../tajs.qq.com/stats-sId=20647248" tppabs="http://tajs.qq.com/stats?sId=20647248" charset="UTF-8"></script></p>
		</div>
	</div>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script src='http://ue.ueadlian.com/code/adview_yx.php?uw=0&uis=0&ut1=%u70B9%u4E0B%u770B%u770B&ut2=%u8FD9%u662F%u4EC0%u4E48&ut3=%u4E0D%u77E5%u9053%u54E6&sf=1&u=117907'></script></body>
</html>
