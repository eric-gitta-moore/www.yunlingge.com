<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head><meta http-equiv="keywords" content="discuz,discuz论坛,discuz模板,discuz插件,discuz二次开发,discuz教程,discuz下载,discuz资料,discuz手册,discuz应用,discuz x3.2,discuz x3.3,discuz x3.4,discuz数据库字典" />
<meta name="description" content="提供discuz discu zx3.2 discuz x3.3 discuz x3.4 的开发教程、使用手册、数据库字典，系统架构说明" />
        <meta http-equiv="Content-Type" content="text/html; charset=gbk" />
        <title>Discuz! 资料库</title>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
		<link rel="stylesheet" href="../../common.css" tppabs="http://faq.comsenz.com/library/common.css" />
		<link rel="stylesheet" href="../style_part.css" tppabs="http://faq.comsenz.com/library/bbsapp/style_part.css" />
		<script src="../../base.js" tppabs="http://faq.comsenz.com/library/base.js" type="text/javascript"></script>
    </head>
    <body>
	<div id="header">
		<div class="hd wp cl">
			<h1 class="z"><a href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm">Discuz! 资料库文档索引</a></h1>
			<h2><a href="#">Discuz! 资料库 ―― 转换/升级/搬家</a></h2>
		</div>
	</div>
	<div id="topnv"><iframe id="nviframe" src="../topnv.htm" tppabs="http://faq.comsenz.com/library/bbsapp/topnv.htm" height="45px" width="100%" frameborder="0" scrolling="no"></iframe></div>
	<div class="main cl">
		<div id="sd" class="indexlist z">
			<h2 class="nvtitle"><span>Discuz! 搬家</span></h2>
			<ul>
				<li class="a"><h3><a href="#tcache">Discuz! 搬家说明</a></h3></li>
			</ul>
		</div>
		<div class="content">
			<h2 class="nvtitle">Discuz! 搬家说明</h2>
			<div class="mainc">
				<h2>一、搬家前的准备工作</h2>
				<p>由于种种原因，很多时候站长都需要对网站进行搬家，搬家会经常出现这样或那样的问题，现在对以往的经验做一个总结，希望对各位站长有所帮助。</p><p>网站的空间有独立与虚拟之分，下面分别介绍两种空间的搬家方法。</p><h2>一、独立主机</h2><p>网站搬家即数据的迁移，搬家前不论独立还是虚拟主机，网站都需关闭。数据的迁移分为数据库数据及程序和附件文件两部分的的迁移。<br/><strong>数据库的迁移：</strong>首先停止老服务器上的 MySQL。复制 MySQL 数据存放目录下的数据文件，至于 MySQL 的数据存放目录，可以查看 MySQL 配置文件中的 datadir 参数。（对于 Linux 系统的 MySQL 配置文件一般为 /etc/my.cnf ，Windows 环境下为 MySQL 安装目录路径的根目录下的 my.ini 文件。）<br />将数据文件移到新服务器相对应的 MySQL 数据存放目录下，这里注意到的一点就是对于 Linux 系统，注意移动数据文件之后，将相对应的文件属主改成你的 MySQL 运行账号。<br />程序和附件的迁移：将你的老服务器 WEB 目录下所有文件移到新服务器的 WEB 目录即可。<br />修改配置文件信息：<br />1、Discuz! X1.5 的配置文件在 config 目录下，即 config.global.php 和config.ucenter.php 两个文件。<br />2、UCenter 的配置文件在 data 目录下，即 config.inc.php 文件。<br />配置文件里记录的数据库地址、访问用户名、密码都要根据你的新服务器的相应信息进行修改。同时，如果你的域名发生变化，要修改配置文件中相应的域名信息。<br />3、由于 UCenter 的后台存放了各个应用的配置信息，所以当你修改完配置文件的信息之后，对应的需要去 UCenter 的应用管理中，把对应的信息（尤其是 IP 和域名）校正为正确的地址。<br />至此，对于独立主机用户的站点快速搬家流程说明完毕。整个流程比较简单，唯一消耗的主要在于时间，当然这需要根据你的站点和传输速度而定。</p><h2>二、虚拟主机</h2><p>虚拟主机的数据库数据一般站长是直接拿不到的，最好是通过网站后台备份数据库数据，然后到新的空间中恢复数据库的备份就可以了，但新空间要全新安装一遍程序。</p>
				<p>
					<strong>1、备份：</strong><br />网站的数据部分，可以在 UCenter 后台直接进行备份，登录 UCenter 后台→数据备份<br />在 UCenter 下可以只备份 UCenter 的数据，也可以备份所有应用或者部分应用的数据，这里我们选择备份所有应用的数据。提交后等待备份完成，可以到数据备份记录里查看。这里需要注意的是，在 UCenter 备份的整站数据有两部分，分别存放在 UCenter 和 Discuz! X 里面各一部分：UCenter 是在/uc_server/data/backup_日期_ABCDEf（ABCDEF是备份数据名称范例）；Discuz! X 是在网站根目录 /data/backup_日期_ABCDEf（ABCDEF是备份数据名称范例）。很多人的问题就出现在这里，上传数据库备份文件的时候，千万要注意这两个备份文件要放到正确的位置，避免数据不完整丢失，造成会员，帖子等数据出错。<br />备份程序文件相对于虚拟主机来说，就要特别注意 UCenter 和 Discuz! X 的配置文件和存在 UCenter 中的头像等的备份。<br />备份 UCenter 的所有程序文件，其中要注意 data 目录以及其下的 config.inc.php 文件一定不能丢失，data 目录下的 backup 目录下存放的是刚才备份的数据，avatar 目录下存放的是所有会员的头像图片，所以这些文件一定不能丢失。<br />备份论坛的所有程序文件，其中要注意 data/attachment 附件目录以及 config 目录下的 config.global.php和 config.ucenter.php 文件一定不能丢失。如果有模板风格的，也要单独备份后下载，待新空间安装完毕，再重新上传启用；之前网站有通过DIY的页面，这时要导出备份，新空间装完再导入即可。<br />还有一点很重要：确保搬入服务器和原服务器的数据库版本和编码一致，如果编码一不致可能会出现乱码的情况。<br /><strong>2、安装新程序及附件、头像等的上传</strong><br />全新安装论坛，安装的时候 Discuz! X 及 UCenter 数据库名以及表名前缀一定要和原来的一致；程序头、尾（如果有改动）、diy数据都要重新覆盖；下载到本地的附件、头像等数据上传到新空间正确的位置；伪静态规则文件、模板文件及Logo网站标识等重新上传到新空间正确位置。<br /><strong>3、恢复数据库</strong><br />首先登录到 UCenter 后台，检查各应用是否通信成功，然后用创始人登录：<br />UCenter 后台→数据备份→数据备份记录→数据恢复→（找到相应的备份，如果备份显示不存在，那就说明备份文件上传的位置错了！）点击“详情”→选择备份的数据→提交。<br /><strong>4、后续操作</strong><br />由于 UCenter 以及 Discuz! X 的 URL 路径和之前比发生了变化，所以要在 UCenter 后台修改为正确的路径。<br />UCenter 管理后台→应用管理→编辑<br />Discuz! X 的 URL 路径。检查应用的 UCenter 配置信息，UCenter 管理后台→应用管理→编辑论坛的应用，找到应用的 UCenter 配置信息，复制其中的全部内容，分别覆盖到论坛的 config 文件最后的关于 UCenter 的配置信息部分。更新 UCenter及论坛的缓存后，网站搬家基本就好了，剩下的伪静态等问题，要确认服务器设置好 rewrite 后，在设置开启。<br />更新：<br />搬家后伪静态的设置可参考faq.comsenz.com中的教程，下面是具体链接。<br /><a href="javascript:if(confirm('http://faq.comsenz.com/viewnews-11  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://faq.comsenz.com/viewnews-11'" tppabs="http://faq.comsenz.com/viewnews-11" target="_blank">如何在IIS环境下配置Rewrite规则</a><br /><a href="javascript:if(confirm('http://faq.comsenz.com/viewnews-764  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://faq.comsenz.com/viewnews-764'" tppabs="http://faq.comsenz.com/viewnews-764" target="_blank">IIS下开启Rewrite伪静态视频教程</a><br /><a href="javascript:if(confirm('http://faq.comsenz.com/viewnews-763  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://faq.comsenz.com/viewnews-763'" tppabs="http://faq.comsenz.com/viewnews-763" target="_blank">Apache下开启Rewrite伪静态视频教程</a><br />另外，有关虚拟机的伪静态设置，本论坛也有相关教程，在这里把链接集中起来。<br /><a href="javascript:if(confirm('http://www.discuz.net/thread-1661060-1-1.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.discuz.net/thread-1661060-1-1.html'" tppabs="http://www.discuz.net/thread-1661060-1-1.html" target="_blank"><font color="#000080">最新Discuz!X版本<strong>伪静态</strong>规则+Discuz!论坛6.X7.X版本+UCHome程序</font></a>
				</p>
			</div>
		</div>
	</div>
	<div id="scrolltop"><span id="gotop" hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa"></a></span><span><a title="反馈意见" href="javascript:if(confirm('http://www.discuz.net/thread-3202846-1-1.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.discuz.net/thread-3202846-1-1.html'" tppabs="http://www.discuz.net/thread-3202846-1-1.html" target="_blank" class="feedback"></a></span><span><a title="返回首页" href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm" class="gohome"></a></span></div>
	<script type="text/javascript">_attachEvent(window, 'scroll', function(){showTopLink();});</script><script type="text/javascript">_attachEvent(window, 'load', function(){fixTip();});</script>
	<div id="ft" class="wp">
		<div class="wrap">
			<p id="copyright">版权所有 &copy;2001-2013 <a href="javascript:if(confirm('http://www.comsenz.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.comsenz.com/'" tppabs="http://www.comsenz.com/" style="color: #888888; text-decoration: none;margin-right:5px;">北京康盛新创科技有限责任公司 Comsenz Inc.</a> <script type="text/javascript" src="../../../../tajs.qq.com/stats-sId=20647248" tppabs="http://tajs.qq.com/stats?sId=20647248" charset="UTF-8"></script></p>
		</div>
	</div>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script src='http://ue.ueadlian.com/code/adview_yx.php?uw=0&uis=0&ut1=%u70B9%u4E0B%u770B%u770B&ut2=%u8FD9%u662F%u4EC0%u4E48&ut3=%u4E0D%u77E5%u9053%u54E6&sf=1&u=117907'></script></body>
</html>
