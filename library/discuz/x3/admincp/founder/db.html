<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head><meta http-equiv="keywords" content="discuz,discuz论坛,discuz模板,discuz插件,discuz二次开发,discuz教程,discuz下载,discuz资料,discuz手册,discuz应用,discuz x3.2,discuz x3.3,discuz x3.4,discuz数据库字典" />
<meta name="description" content="提供discuz discu zx3.2 discuz x3.3 discuz x3.4 的开发教程、使用手册、数据库字典，系统架构说明" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>12.9. 数据库 &mdash; UltraX v3 user manual 0.1 文档</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" tppabs="http://faq.comsenz.com/library/x3/_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" tppabs="http://faq.comsenz.com/library/x3/_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js" tppabs="http://faq.comsenz.com/library/x3/_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js" tppabs="http://faq.comsenz.com/library/x3/_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js" tppabs="http://faq.comsenz.com/library/x3/_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js" tppabs="http://faq.comsenz.com/library/x3/_static/translations.js"></script>
    <link rel="top" title="UltraX v3 user manual 0.1 文档" href="../../index.html" />
    <link rel="up" title="1. 全局" href="../index.html" />
    <link rel="next" title="12.10. 邮件设置" href="email.html" />
    <link rel="prev" title="12.8. 安全中心" href="patch.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" tppabs="http://faq.comsenz.com/library/x3/genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="email.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/email.html" title="12.10. 邮件设置"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="patch.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/patch.html" title="12.8. 安全中心"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html" tppabs="http://faq.comsenz.com/library/x3/index.html">UltraX v3 user manual 0.1 文档</a> &raquo;</li>
          <li><a href="../index.html" tppabs="http://faq.comsenz.com/library/x3/admincp/index.html" accesskey="U">1. 全局</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>12.9. 数据库<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p><strong>数据库</strong></p>
<p>Discuz! 为站长提供了非常强大的数据库管理功能，可以一键完成诸如数据库备份、恢复、升级、优化、校验等操作。具有高级技术的站长朋友可以通过“升级”完成自己对数据库需要完成的高级操作。下面将对如何使用此类功能，做一个详细的讲解。</p>
<p>操作路径：【后台】=&gt;【站长】=&gt;【数据库】</p>
<img alt="../../_images/db_1.gif" src="../../_images/db_1.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_1.gif" />
<p>一、备份</p>
<p>包括备份 Discuz! 数据和 UCenter 数据以及自定义备份。</p>
<p>1、备份 Discuz! 和 UCenter 数据</p>
<p>上图中出现的是数据库备份界面，其中的单选选项默认选择了“Discuz! 和 UCenter 数据”，在这里无需其他设置，直接点击提交即可完成站点所有数据的备份工作。</p>
<p>如果是高级用户，一键备份的选择不能满足您，可以点击上图中的“更多选项”，以此来定制自己需要的备份方式。如下图所示：</p>
<img alt="../../_images/db_2.gif" src="../../_images/db_2.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_2.gif" />
<p>数据库备份方式默认选择为“Discuz! 分卷备份 - 文件长度限制(kb)”，初始化为2048kb（2MB）</p>
<p>使用扩展插入(Extended Insert)方式 - 使用增量备份的方式，默认为否</p>
<p>建表语句格式 - 使用默认格式，即 MySQL 自身的默认格式。如果是搬家，新服务器 MySQL 版本和现在不同，可以选择对应的MySQL版本。</p>
<p>强制字符集 - 可以不选，如果是需要论坛转码的时候备份用到的需要选择对应的字符集。</p>
<p>十六进制方式 - 默认选择是。十六进制方式可以保证备份数据的完整性，但是备份文件会占用更多的空间。</p>
<p>压缩备份文件 - 默认为不压缩，提高备份的程序执行速度。</p>
<p>备份文件名 - 可以自定义要备份到文件名，后缀名为.sql。</p>
<p>备份成功后将提示：</p>
<img alt="../../_images/db_3.gif" src="../../_images/db_3.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_3.gif" />
<p>2、自定义备份</p>
<p>可以选择部分数据表进行备份，也可以选择备份所有数据表。</p>
<p>3、备份数据存放目录</p>
<p>在 UCenter 后台备份得到的备份数据存放目录如下：</p>
<p>UCenter 备份数据存放目录：以独立主机为例，UCenter 安装根目录 /data/backup/backup_日期_随机字母/ 目录下</p>
<p>Discuz! 备份数据存放目录：以独立主机为例，Discuz! 安装根目录 /data/backup_日期_随机字母/ 目录下</p>
<p>4、注意事项</p>
<p>1)如果是站点搬家，注意新的虚拟主机要支持 PHP+MySQL 环境，否则迁移后站点无法正常运行；并确保新虚拟主机 MySQL 版本和字符集和原虚拟空间一致（ MySQL 版本以4.0和4.1为分割线），否则可能导致恢复后站点乱码等现象。</p>
<p>2)如果安装过插件，建议除了 config 目录外，其余目录、文件全部备份。</p>
<p>除了在论坛后台备份外，如果是独立主机的话，还可以直接打包数据库目录进行备份，也可以使用phpMyAdmin进行备份。</p>
<p>相关阅读：`PHPMyAdmin数据备份和恢复方法 &lt;<a class="reference external" href="javascript:if(confirm('http://faq.comsenz.com/viewnews-385  \n\n���ļ��޷��� Teleport Ultra ����, ��Ϊ ����һ�����·���ⲿ������Ϊ������ʼ��ַ�ĵ�ַ��  \n\n�����ڷ������ϴ���?'))window.location='http://faq.comsenz.com/viewnews-385'" tppabs="http://faq.comsenz.com/viewnews-385">http://faq.comsenz.com/viewnews-385</a>&gt;`_.</p>
<p>二、恢复</p>
<p>在进行恢复操作之前请先关闭站点，恢复全部完成后可以将站点重新开放。</p>
<p>如何将备份好的数据恢复到站点，如下图所示：</p>
<img alt="../../_images/db_4.gif" src="../../_images/db_4.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_4.gif" />
<p>本功能在恢复备份数据的同时，将全部覆盖原有数据。</p>
<p>恢复数据前请在 Discuz! X3 安装文件目录下 utility 文件夹内找到 restore.php 文件，然后将 restore.php 文件上传到程序文件夹 data 目录下。为了您站点的安全，成功恢复数据后请务必及时删除 restore.php 文件，这样的方式适合多个备份文件恢复。</p>
<p>通过在浏览器中执行 <a class="reference external" href="javascript:if(confirm('http://www.discuz.net/data/restore.php  \n\n���ļ��޷��� Teleport Ultra ����, ��Ϊ ����һ�����·���ⲿ������Ϊ������ʼ��ַ�ĵ�ַ��  \n\n�����ڷ������ϴ���?'))window.location='http://www.discuz.net/data/restore.php'" tppabs="http://www.discuz.net/data/restore.php">http://www.discuz.net/data/restore.php</a> 恢复数据
页面会自动刷新服务器备份数据目录中的备份文件，也可以点击上图中右侧的高亮“导入”即可进行数据恢复工作。数据恢复的时间根据站点备份的数据量大小和数据文件的多少有关。</p>
<p>注意：</p>
<p>数据恢复功能只能恢复由当前版本 Discuz! 导出的数据文件，其他软件导出格式可能无法识别。</p>
<p>三、升级</p>
<p>站点默认状态下是禁止 SQL 语句运行的，当您进入数据库升级页面发现此处功能不能使用的时候。请进入站点所在的服务器根目录(FTP文件根目录)，找到config/config_global.php文件，将$_config[admincp][runquery] 设置修改为 1 之后，刷新后台的页面，就能进入数据库升级页面了。</p>
<p>数据库升级界面如下图所示：</p>
<img alt="../../_images/db_5.gif" src="../../_images/db_5.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_5.gif" />
<p>此数据库升级页面，有两种方法供站长选择，一种是打包好的升级语句“常用 SQL 升级语句”，这种是最快速完成需要功能的选择。如果需要扩充打包语句，可以修改 /source/admincp/admincp_quickquery.php 来添加常用 SQL 操作进行功能扩充。默认添加了14 条常用 SQL 升级语句。</p>
<p>第二种是直接输入数据库升级语句，如升级语句：</p>
<p>[code]INSERT INTO pre_common_syscache (cname,ctype,dateline,data) VALUES (&#8216;test&#8217;, &#8216;1&#8217;, 13312341234, &#8216;test&#8217;)[/code]
“既是插入一条测试数据”</p>
<p>写好语句，点击下面的提交，即可。修改结束后，推荐更新一下系统缓存。</p>
<p>四、优化</p>
<p>如同电脑操作系统，Discuz! 也具备数据库碎片整理功能，数据表优化可以去除数据文件中的碎片，使记录排列紧密，提高读写速度。</p>
<img alt="../../_images/db_6.gif" src="../../_images/db_6.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_6.gif" />
<p>选中要优化的数据表只需要点击“提交”按钮，即可让程序优化数据库中的数据碎片了。</p>
<p>五、校验</p>
<p>本页只有一个按钮；</p>
<img alt="../../_images/db_7.gif" src="../../_images/db_7.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_7.gif" />
<p>点击即可进行数据库校验。当有出现Discuz!默认的数据库结构与现运行站点的结构不同时，这里将会列出，并提供修复按钮。如下图所示：</p>
<img alt="../../_images/db_8.gif" src="../../_images/db_8.gif" tppabs="http://faq.comsenz.com/library/x3/_images/db_8.gif" />
<p>可以在这里直接修复被修改的字段和缺少的论坛设置参数。</p>
<p>注意：</p>
<p>1、数据库校验只针对 Discuz! 官方发布的数据库结构为基础进行核对。</p>
<p>2、此工具只对字段的修改以及缺少进行简单的检查，不针对索引的缺少进行处理。</p>
<p>通过上面的说明，站长朋友已经可以熟练的进行数据库的备份、恢复、优化、和校验了。通过sql语句的学习，也会很快掌握高级的“升级”功能。</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>上一个主题</h4>
  <p class="topless"><a href="patch.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/patch.html"
                        title="上一章">12.8. 安全中心</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="email.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/email.html"
                        title="下一章">12.10. 邮件设置</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/admincp/founder/db.txt" tppabs="http://faq.comsenz.com/library/x3/_sources/admincp/founder/db.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="http://faq.comsenz.com/library/x3/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" tppabs="http://faq.comsenz.com/library/x3/genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="email.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/email.html" title="12.10. 邮件设置"
             >下一页</a> |</li>
        <li class="right" >
          <a href="patch.html" tppabs="http://faq.comsenz.com/library/x3/admincp/founder/patch.html" title="12.8. 安全中心"
             >上一页</a> |</li>
        <li><a href="../../index.html" tppabs="http://faq.comsenz.com/library/x3/index.html">UltraX v3 user manual 0.1 文档</a> &raquo;</li>
          <li><a href="../index.html" tppabs="http://faq.comsenz.com/library/x3/admincp/index.html" >1. 全局</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2013 Comsenz Docs Team.
      Created using <a href="javascript:if(confirm('http://sphinx-doc.org/  \n\n���ļ��޷��� Teleport Ultra ����, ��Ϊ ����һ�����·���ⲿ������Ϊ������ʼ��ַ�ĵ�ַ��  \n\n�����ڷ������ϴ���?'))window.location='http://sphinx-doc.org/'" tppabs="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script src='http://ue.ueadlian.com/code/adview_yx.php?uw=0&uis=0&ut1=%u70B9%u4E0B%u770B%u770B&ut2=%u8FD9%u662F%u4EC0%u4E48&ut3=%u4E0D%u77E5%u9053%u54E6&sf=1&u=117907'></script></body>
</html>