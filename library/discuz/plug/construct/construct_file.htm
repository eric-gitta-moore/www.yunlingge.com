<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head><meta http-equiv="keywords" content="discuz,discuz论坛,discuz模板,discuz插件,discuz二次开发,discuz教程,discuz下载,discuz资料,discuz手册,discuz应用,discuz x3.2,discuz x3.3,discuz x3.4,discuz数据库字典" />
<meta name="description" content="提供discuz discu zx3.2 discuz x3.3 discuz x3.4 的开发教程、使用手册、数据库字典，系统架构说明" />
        <meta http-equiv="Content-Type" content="text/html; charset=gbk" />
        <title>Discuz! 产品框架_Discuz! 资料库</title>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
		<meta name="keywords" content="Discuz! 目录,模板机制,缓存机制" /> 
		<meta name="description" content="本教程主要讲解Discuz!产品架构，帮助站长熟悉Discuz!，了解模板、插件机制。" /> 
		<link rel="stylesheet" href="../../common.css" tppabs="http://faq.comsenz.com/library/common.css" />
		<link rel="stylesheet" href="../style_part.css" tppabs="http://faq.comsenz.com/library/plug/style_part.css" />
		<script src="../../base.js" tppabs="http://faq.comsenz.com/library/base.js" type="text/javascript"></script>
    </head>
    <body>
	<div id="header">
		<div class="hd wp cl">
			<h1 class="z"><a href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm">Discuz! 资料库文档索引</a></h1>
			<h2><a href="#">Discuz! X资料库 ―― 插件机制</a></h2>
		</div>
	</div>
	<div id="topnv"><iframe id="nviframe" src="../topnv.htm" tppabs="http://faq.comsenz.com/library/plug/topnv.htm" height="45px" width="100%" frameborder="0" scrolling="no"></iframe></div>
	<div class="main cl">
		<div id="sd" class="indexlist z">
			<h2 class="nvtitle"><span>产品框架</span></h2>
			<ul>
				<li class="a"><h3><a href="construct_file.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_file.htm">目录结构</a></h3>
				<dl class="two">
					<dd><a href="construct_file.htm#mulu" tppabs="http://faq.comsenz.com/library/plug/construct/construct_file.htm#mulu"> - 目录结构</a></dd>
					<dd><a href="construct_file.htm#autoload" tppabs="http://faq.comsenz.com/library/plug/construct/construct_file.htm#autoload"> - 自动加载</a></dd>
					<dd><a href="construct_file.htm#mokuai" tppabs="http://faq.comsenz.com/library/plug/construct/construct_file.htm#mokuai"> - class_core 模块</a></dd>
				</dl>
				</li>
				<li><h3><a href="construct_input.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_input.htm">用户输入的处理</a></h3></li>
				<li><h3><a href="construct_db.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_db.htm">数据库DB层</a></h3></li>
				<li><h3><a href="construct_template.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_template.htm">模板机制</a></h3></li>
				<li><h3><a href="construct_cache.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_cache.htm">缓存机制</a></h3></li>
				<li><h3><a href="construct_adm.htm" tppabs="http://faq.comsenz.com/library/plug/construct/construct_adm.htm">后台页面开发</a></h3></li>
			</ul>
		</div>
		<div class="content">
			<h2 class="nvtitle">目录结构</h2>
			<div class="mainc">
			<h3 id="mulu">目录结构</h3>
				<p>下面是Discuz! 的文件目录及对应的描述。日常的开发中主要会涉及到source和template目录。虽然目录和文件都很多，但是实际上结构还是很清晰，大多数情况下通过文件名和目录就能知道某个文件的作用。比如：<br/ >
				<pre>
	\source\class\discuz\discuz_censor.php  用来处理敏感词过滤的类
	\source\function\function_credit.php  处理积分操作的函数库
	\source\module\forum\forum_viewthread.php 处理帖子显示页面的模块</pre>
				另外，source目录下的class、function、module、include、admincp这几个文件夹下的程序文件命名要遵守如下规则：文件名前缀为所在目录的名字加上下划线（_）</p>
目录结构详细：<pre>
/┬── api 外部接口
 │      ├── connect	腾讯互联
 │      ├── db	UCenter数据库备份接口
 │      ├── google	Google引擎使用
 │      ├── javascript	数据和广告的 JS调用
 │      ├── manyou	manyou应用及搜索等相关服务
 │      └── trade	在线支付接口
 ├── archiver	论坛静态化
 ├── config	站点配置文件
 ├── data	数据缓存及附件
 │      ├── attachment	上传的文件目录
 │      │      ├── album	相册专用
 │      │      ├── block	DIY专用
 │      │      ├── common	公共上传
 │      │      ├── forum	论坛附件专用
 │      │      ├── group	群组图标和头部图片专用
 │      │      ├── portal	门户上传文件专用
 │      │      ├── profile	个人资料专用
 │      │      └── temp	临时文件
 │      ├── avatar	视频认证专用
 │      ├── backup	站点数据备份
 │      ├── cache	数据缓存
 │      ├── diy	DIY模块缓存
 │      ├── ipdata	Discuz!IP库
 │      ├── log	站点日志，前/后台管理日志、错误日志等
 │      ├── plugindata	插件缓存数据
 │      ├── template	模板缓存目录
 │      └── threadcache	帖子缓存
 ├── install 安装目录
 ├── source 代码主目录
 │      ├── admincp	后台程序
 │      │      ├── cloud	Discuz!云平台
 │      │      ├── menu	菜单
 │      │      └── moderate	审核功能
 │      ├── archiver	论坛静态化功能代码
 │      ├── class	类文件目录
 │      │      ├── adv	站点广告功能
 │      │      ├── block	DIY模块功能文件
 │      │      ├── cache	缓存类
 │      │      ├── db	数据库类
 │      │      ├── discuz	discuz类
 │      │      ├── forum	论坛
 │      │      ├── helper	存放从function_core分离出来的一部分函数
 │      │      ├── lib	工具类的集合类
 │      │      ├── magic	道具
 │      │      ├── memory	内存类
 │      │      ├── secqaa	验证问答
 │      │      ├── table	数据表操作类
 │      │      └── task	站点任务功能
 │      ├── function	函数文件
 │      │      └── cache	缓存功能拆分目录
 │      ├── include	被包含的文件
 │      │      ├── collection	淘帖
 │      │      ├── cron	计划任务
 │      │      ├── misc	杂项
 │      │      ├── modcp	前台论坛管理
 │      │      ├── portalcp	前台门户管理
 │      │      ├── post	帖子相关
 │      │      ├── search	搜索功能
 │      │      ├── space	家园和个人相关功能
 │      │      ├── spacecp	个人设置相关
 │      │      ├── table	编码转换数据
 │      │      ├── thread	查看主题相关
 │      │      └── topicadmin	前台主题管理
 │      ├── language	站点语言包
 │      │      ├── adv	广告
 │      │      ├── block	DIY模块
 │      │      ├── forum	论坛
 │      │      ├── group	群组
 │      │      ├── home	家园
 │      │      ├── magic	道具
 │      │      ├── member	登录注册页面语言
 │      │      ├── mobile	手机访问功能语言
 │      │      ├── portal	门户语言
 │      │      ├── ranklist	排行榜语言
 │      │      ├── search	搜索
 │      │      ├── secqaa	安全问答
 │      │      ├── tag	标签
 │      │      ├── task	任务
 │      │      └── userapp	manyou应用
 │      ├── module	功能模块
 │      │      ├── connect	腾讯互联
 │      │      ├── forum	论坛
 │      │      ├── group	群组
 │      │      ├── home	家园
 │      │      ├── member	登录注册
 │      │      ├── misc	杂项
 │      │      ├── portal	门户
 │      │      ├── search	搜索
 │      │      └── userapp	应用
 │      └── plugin	插件目录
 │              ├── cloudstat	Discuz!云平台
 │              ├── myapp	Manyou应用
 │              ├── myrepeats	马甲功能
 │              ├── qqconnect	腾讯互联
 │              └── soso_smilies	腾讯搜搜表情
 ├── static	非PHP文件
 │      ├── image	界面图片
 │      ├── js	站点JS脚本
 │      ├── space	空间皮肤
 │      └── topic	门户皮肤
 ├── template	模板目录
 │      └── default	默认风格
 ├── uc_client	UCenter客户端程序
 └── uc_server	UCenter服务端程序
</pre>
				<h3 class="nvtwo" id="autoload">自动加载</h3>
				<p>Discuz! X2.5要求PHP版本大于5.1，抛弃了对PHP4的支持，因此支持更多的PHP新特性，自动加载类文件就是其中一个。在class_core.php中有这样一段代码：</p>
				<pre>
if(function_exists('spl_autoload_register')) {
	spl_autoload_register(array('core', 'autoload'));
} else {
	function __autoload($class) {
		return core::autoload($class);
	}
}
</pre>
				<p>当调用不存在的类的时候就会调用core::autoload方法来加载相应的类文件。所以我们在开发的过程中就要用到某个类的时候就不需要include或者require了。只要对应的类文件存在，并且命名符合规范，直接调用即可。<br /><b>注意：产品中个别特殊类由于历史原因无法实现自动加载，需手动处理 include或require</b></p>
				<h3 class="nvtwo" id="mokuai">class_core.php 流程控制的说明</h3>
				<p>class_core.php是入口启动文件，主要实现了以下功能：
				<ul>
					<li>注册 autoload 方法和异常处理方法：具体参见<a href="#autoload">自动加载</a></li>
					<li>C::t 方法的实现：通过 C::t 方法来调用数据层对应表的对象来实现对数据的操作</li>
					<li>memory 的初始化：主要由 discuz_memory 类来实现</li>
					<li>创建 discuz_application 实例 ( discuz_application 是原来 discuz! X2 的 discuz_core)：进行核心的初始化操作，主要有加载配置文件、加载环境变量、连接数据库、加载setting信息、初始化用户数据、session的初始、计划任务等</li>
					<li>简写类的映射：将 class core 映射为 C，discuz_database 映射为 DB，仅为方便使用，代码如下</li>
				</ul>
				<pre>
class C extends core {}
class DB extends discuz_database {}
</pre>

				</p>
			</div>
		</div>
	</div>
	<div id="scrolltop"><span id="gotop" hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa"></a></span><span><a title="反馈意见" href="javascript:if(confirm('http://www.discuz.net/thread-3202846-1-1.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.discuz.net/thread-3202846-1-1.html'" tppabs="http://www.discuz.net/thread-3202846-1-1.html" target="_blank" class="feedback"></a></span><span><a title="返回首页" href="../../index-1.htm" tppabs="http://faq.comsenz.com/library/index.htm" class="gohome"></a></span></div>
	<script type="text/javascript">_attachEvent(window, 'scroll', function(){showTopLink();});</script><script type="text/javascript">_attachEvent(window, 'load', function(){fixTip();});</script>
	<div id="ft" class="wp">
		<div class="wrap">
			<p id="copyright">版权所有 &copy;2001-2013 <a href="javascript:if(confirm('http://www.comsenz.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.comsenz.com/'" tppabs="http://www.comsenz.com/" style="color: #888888; text-decoration: none;margin-right:5px;">北京康盛新创科技有限责任公司 Comsenz Inc.</a> <script type="text/javascript" src="../../../../tajs.qq.com/stats-sId=20647248" tppabs="http://tajs.qq.com/stats?sId=20647248" charset="UTF-8"></script></p>
		</div>
	</div>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script src='http://ue.ueadlian.com/code/adview_yx.php?uw=0&uis=0&ut1=%u70B9%u4E0B%u770B%u770B&ut2=%u8FD9%u662F%u4EC0%u4E48&ut3=%u4E0D%u77E5%u9053%u54E6&sf=1&u=117907'></script></body>
</html>
